var Cr=Object.create;var Bt=Object.defineProperty;var Ar=Object.getOwnPropertyDescriptor;var _r=Object.getOwnPropertyNames;var Tr=Object.getPrototypeOf,xr=Object.prototype.hasOwnProperty;var Rn=(n,e)=>{for(var t in e)Bt(n,t,{get:e[t],enumerable:!0})},Dn=(n,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of _r(e))!xr.call(n,i)&&i!==t&&Bt(n,i,{get:()=>e[i],enumerable:!(s=Ar(e,i))||s.enumerable});return n};var Or=(n,e,t)=>(t=n!=null?Cr(Tr(n)):{},Dn(e||!n||!n.__esModule?Bt(t,"default",{value:n,enumerable:!0}):t,n)),Pr=n=>Dn(Bt({},"__esModule",{value:!0}),n);var Go={};Rn(Go,{default:()=>Ps});module.exports=Pr(Go);function $n(n,e,t,s,i,r){n.emit("generateNode",e,t,s,i,r)}function qn(n,e){n.on("showNotice",e)}function Fn(n,e){n.on("updateNodeText",e)}function Kn(n,e){n.on("setNodeData",e)}function Un(n,e){n.on("createNode",async(t,s)=>{try{let i=await e(t);s(i)}catch(i){console.error("[createNode] Handler error:",i),s({message:i instanceof Error?i.message:"Unknown error"})}})}function Vn(n,e){n.on("log",e)}function jn(n,e){n.on("updateStatusBar",e)}function Yn(n,e){n.on("setNodeStatus",e)}function Wn(n,e){n.on("deleteNode",e)}function Hn(n,e){n.on("searchNoteInVault",async(t,s)=>{try{let i=await e(t);s(i)}catch(i){console.error("[searchNoteInVault] Handler error:",i),s({message:i instanceof Error?i.message:"Unknown error"})}})}var B=require("obsidian");var J=Object.create(null);J.open="0";J.close="1";J.ping="2";J.pong="3";J.message="4";J.upgrade="5";J.noop="6";var st=Object.create(null);Object.keys(J).forEach(n=>{st[J[n]]=n});var nt={type:"error",data:"parser error"};var Gn=typeof Blob=="function"||typeof Blob!="undefined"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Qn=typeof ArrayBuffer=="function",Xn=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n&&n.buffer instanceof ArrayBuffer,it=({type:n,data:e},t,s)=>Gn&&e instanceof Blob?t?s(e):zn(e,s):Qn&&(e instanceof ArrayBuffer||Xn(e))?t?s(e):zn(new Blob([e]),s):s(J[n]+(e||"")),zn=(n,e)=>{let t=new FileReader;return t.onload=function(){let s=t.result.split(",")[1];e("b"+(s||""))},t.readAsDataURL(n)};function Jn(n){return n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer,n.byteOffset,n.byteLength)}var Is;function Zn(n,e){if(Gn&&n.data instanceof Blob)return n.data.arrayBuffer().then(Jn).then(e);if(Qn&&(n.data instanceof ArrayBuffer||Xn(n.data)))return e(Jn(n.data));it(n,!1,t=>{Is||(Is=new TextEncoder),e(Is.encode(t))})}var ei="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",rt=typeof Uint8Array=="undefined"?[]:new Uint8Array(256);for(let n=0;n<ei.length;n++)rt[ei.charCodeAt(n)]=n;var ti=n=>{let e=n.length*.75,t=n.length,s,i=0,r,o,a,c;n[n.length-1]==="="&&(e--,n[n.length-2]==="="&&e--);let l=new ArrayBuffer(e),f=new Uint8Array(l);for(s=0;s<t;s+=4)r=rt[n.charCodeAt(s)],o=rt[n.charCodeAt(s+1)],a=rt[n.charCodeAt(s+2)],c=rt[n.charCodeAt(s+3)],f[i++]=r<<2|o>>4,f[i++]=(o&15)<<4|a>>2,f[i++]=(a&3)<<6|c&63;return l};var Ir=typeof ArrayBuffer=="function",ot=(n,e)=>{if(typeof n!="string")return{type:"message",data:si(n,e)};let t=n.charAt(0);return t==="b"?{type:"message",data:Lr(n.substring(1),e)}:st[t]?n.length>1?{type:st[t],data:n.substring(1)}:{type:st[t]}:nt},Lr=(n,e)=>{if(Ir){let t=ti(n);return si(t,e)}else return{base64:!0,data:n}},si=(n,e)=>{switch(e){case"blob":return n instanceof Blob?n:new Blob([n]);case"arraybuffer":default:return n instanceof ArrayBuffer?n:n.buffer}};var ni="",ii=(n,e)=>{let t=n.length,s=new Array(t),i=0;n.forEach((r,o)=>{it(r,!1,a=>{s[o]=a,++i===t&&e(s.join(ni))})})},ri=(n,e)=>{let t=n.split(ni),s=[];for(let i=0;i<t.length;i++){let r=ot(t[i],e);if(s.push(r),r.type==="error")break}return s};function oi(){return new TransformStream({transform(n,e){Zn(n,t=>{let s=t.length,i;if(s<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,s);else if(s<65536){i=new Uint8Array(3);let r=new DataView(i.buffer);r.setUint8(0,126),r.setUint16(1,s)}else{i=new Uint8Array(9);let r=new DataView(i.buffer);r.setUint8(0,127),r.setBigUint64(1,BigInt(s))}n.data&&typeof n.data!="string"&&(i[0]|=128),e.enqueue(i),e.enqueue(t)})}})}var Ls;function Mt(n){return n.reduce((e,t)=>e+t.length,0)}function Rt(n,e){if(n[0].length===e)return n.shift();let t=new Uint8Array(e),s=0;for(let i=0;i<e;i++)t[i]=n[0][s++],s===n[0].length&&(n.shift(),s=0);return n.length&&s<n[0].length&&(n[0]=n[0].slice(s)),t}function ai(n,e){Ls||(Ls=new TextDecoder);let t=[],s=0,i=-1,r=!1;return new TransformStream({transform(o,a){for(t.push(o);;){if(s===0){if(Mt(t)<1)break;let c=Rt(t,1);r=(c[0]&128)===128,i=c[0]&127,i<126?s=3:i===126?s=1:s=2}else if(s===1){if(Mt(t)<2)break;let c=Rt(t,2);i=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),s=3}else if(s===2){if(Mt(t)<8)break;let c=Rt(t,8),l=new DataView(c.buffer,c.byteOffset,c.length),f=l.getUint32(0);if(f>Math.pow(2,21)-1){a.enqueue(nt);break}i=f*Math.pow(2,32)+l.getUint32(4),s=3}else{if(Mt(t)<i)break;let c=Rt(t,i);a.enqueue(ot(r?c:Ls.decode(c),e)),s=0}if(i===0||i>n){a.enqueue(nt);break}}}})}var Bs=4;function L(n){if(n)return Br(n)}function Br(n){for(var e in L.prototype)n[e]=L.prototype[e];return n}L.prototype.on=L.prototype.addEventListener=function(n,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+n]=this._callbacks["$"+n]||[]).push(e),this};L.prototype.once=function(n,e){function t(){this.off(n,t),e.apply(this,arguments)}return t.fn=e,this.on(n,t),this};L.prototype.off=L.prototype.removeListener=L.prototype.removeAllListeners=L.prototype.removeEventListener=function(n,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+n];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+n],this;for(var s,i=0;i<t.length;i++)if(s=t[i],s===e||s.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+n],this};L.prototype.emit=function(n){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+n],s=1;s<arguments.length;s++)e[s-1]=arguments[s];if(t){t=t.slice(0);for(var s=0,i=t.length;s<i;++s)t[s].apply(this,e)}return this};L.prototype.emitReserved=L.prototype.emit;L.prototype.listeners=function(n){return this._callbacks=this._callbacks||{},this._callbacks["$"+n]||[]};L.prototype.hasListeners=function(n){return!!this.listeners(n).length};var pe=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0),U=typeof self!="undefined"?self:typeof window!="undefined"?window:Function("return this")(),ci="arraybuffer";function Dt(n,...e){return e.reduce((t,s)=>(n.hasOwnProperty(s)&&(t[s]=n[s]),t),{})}var Mr=U.setTimeout,Rr=U.clearTimeout;function me(n,e){e.useNativeTimers?(n.setTimeoutFn=Mr.bind(U),n.clearTimeoutFn=Rr.bind(U)):(n.setTimeoutFn=U.setTimeout.bind(U),n.clearTimeoutFn=U.clearTimeout.bind(U))}var Dr=1.33;function li(n){return typeof n=="string"?$r(n):Math.ceil((n.byteLength||n.size)*Dr)}function $r(n){let e=0,t=0;for(let s=0,i=n.length;s<i;s++)e=n.charCodeAt(s),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(s++,t+=4);return t}function $t(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function fi(n){let e="";for(let t in n)n.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(n[t]));return e}function ui(n){let e={},t=n.split("&");for(let s=0,i=t.length;s<i;s++){let r=t[s].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1])}return e}var qt=class extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}},ge=class extends L{constructor(e){super(),this.writable=!1,me(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,s){return super.emitReserved("error",new qt(e,t,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){let t=ot(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){let e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){let t=fi(e);return t.length?"?"+t:""}};var at=class extends ge{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";let t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||t()})),this.writable||(s++,this.once("drain",function(){--s||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){let t=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};ri(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){let e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,ii(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=$t()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}};var hi=!1;try{hi=typeof XMLHttpRequest!="undefined"&&"withCredentials"in new XMLHttpRequest}catch(n){}var di=hi;function qr(){}var Ms=class extends at{constructor(e){if(super(e),typeof location!="undefined"){let t=location.protocol==="https:",s=location.port;s||(s=t?"443":"80"),this.xd=typeof location!="undefined"&&e.hostname!==location.hostname||s!==e.port}}doWrite(e,t){let s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",(i,r)=>{this.onError("xhr post error",i,r)})}doPoll(){let e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,s)=>{this.onError("xhr poll error",t,s)}),this.pollXhr=e}},Se=class n extends L{constructor(e,t,s){super(),this.createRequest=e,me(this,s),this._opts=s,this._method=s.method||"GET",this._uri=t,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var e;let t=Dt(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;let s=this._xhr=this.createRequest(t);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&s.setRequestHeader(i,this._opts.extraHeaders[i])}}catch(i){}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(i){}try{s.setRequestHeader("Accept","*/*")}catch(i){}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var i;s.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document!="undefined"&&(this._index=n.requestsCount++,n.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr=="undefined"||this._xhr===null)){if(this._xhr.onreadystatechange=qr,e)try{this._xhr.abort()}catch(t){}typeof document!="undefined"&&delete n.requests[this._index],this._xhr=null}}_onLoad(){let e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};Se.requestsCount=0;Se.requests={};if(typeof document!="undefined"){if(typeof attachEvent=="function")attachEvent("onunload",pi);else if(typeof addEventListener=="function"){let n="onpagehide"in U?"pagehide":"unload";addEventListener(n,pi,!1)}}function pi(){for(let n in Se.requests)Se.requests.hasOwnProperty(n)&&Se.requests[n].abort()}var Fr=function(){let n=mi({xdomain:!1});return n&&n.responseType!==null}(),ke=class extends Ms{constructor(e){super(e);let t=e&&e.forceBase64;this.supportsBinary=Fr&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Se(mi,this.uri(),e)}};function mi(n){let e=n.xdomain;try{if(typeof XMLHttpRequest!="undefined"&&(!e||di))return new XMLHttpRequest}catch(t){}if(!e)try{return new U[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch(t){}}var gi=typeof navigator!="undefined"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative",Ds=class extends ge{get name(){return"websocket"}doOpen(){let e=this.uri(),t=this.opts.protocols,s=gi?{}:Dt(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,s)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let s=e[t],i=t===e.length-1;it(s,this.supportsBinary,r=>{try{this.doWrite(s,r)}catch(o){}i&&pe(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws!="undefined"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){let e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=$t()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}},Rs=U.WebSocket||U.MozWebSocket,Ee=class extends Ds{createSocket(e,t,s){return gi?new Rs(e,t,s):t?new Rs(e,t):new Rs(e)}doWrite(e,t){this.ws.send(t)}};var qe=class extends ge{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{let t=ai(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=e.readable.pipeThrough(t).getReader(),i=oi();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();let r=()=>{s.read().then(({done:a,value:c})=>{a||(this.onPacket(c),r())}).catch(a=>{})};r();let o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){let s=e[t],i=t===e.length-1;this._writer.write(s).then(()=>{i&&pe(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}};var $s={websocket:Ee,webtransport:qe,polling:ke};var Kr=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Ur=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Fe(n){if(n.length>8e3)throw"URI too long";let e=n,t=n.indexOf("["),s=n.indexOf("]");t!=-1&&s!=-1&&(n=n.substring(0,t)+n.substring(t,s).replace(/:/g,";")+n.substring(s,n.length));let i=Kr.exec(n||""),r={},o=14;for(;o--;)r[Ur[o]]=i[o]||"";return t!=-1&&s!=-1&&(r.source=e,r.host=r.host.substring(1,r.host.length-1).replace(/;/g,":"),r.authority=r.authority.replace("[","").replace("]","").replace(/;/g,":"),r.ipv6uri=!0),r.pathNames=Vr(r,r.path),r.queryKey=jr(r,r.query),r}function Vr(n,e){let t=/\/{2,9}/g,s=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&s.splice(0,1),e.slice(-1)=="/"&&s.splice(s.length-1,1),s}function jr(n,e){let t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,i,r){i&&(t[i]=r)}),t}var qs=typeof addEventListener=="function"&&typeof removeEventListener=="function",Ft=[];qs&&addEventListener("offline",()=>{Ft.forEach(n=>n())},!1);var Ie=class n extends L{constructor(e,t){if(super(),this.binaryType=ci,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){let s=Fe(e);t.hostname=s.host,t.secure=s.protocol==="https"||s.protocol==="wss",t.port=s.port,s.query&&(t.query=s.query)}else t.host&&(t.hostname=Fe(t.host).host);me(this,t),this.secure=t.secure!=null?t.secure:typeof location!="undefined"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location!="undefined"?location.hostname:"localhost"),this.port=t.port||(typeof location!="undefined"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(s=>{let i=s.prototype.name;this.transports.push(i),this._transportsByName[i]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=ui(this.opts.query)),qs&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Ft.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){let t=Object.assign({},this.opts.query);t.EIO=Bs,t.transport=e,this.id&&(t.sid=this.id);let s=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}let e=this.opts.rememberUpgrade&&n.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";let t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",n.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":let t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);let e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){let e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let s=0;s<this.writeBuffer.length;s++){let i=this.writeBuffer[s].data;if(i&&(t+=li(i)),s>0&&t>this._maxPayload)return this.writeBuffer.slice(0,s);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;let e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,pe(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,s){return this._sendPacket("message",e,t,s),this}send(e,t,s){return this._sendPacket("message",e,t,s),this}_sendPacket(e,t,s,i){if(typeof t=="function"&&(i=t,t=void 0),typeof s=="function"&&(i=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;let r={type:e,data:t,options:s};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),i&&this.once("flush",i),this.flush()}close(){let e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():e()}):this.upgrading?s():e()),this}_onError(e){if(n.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),qs&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){let s=Ft.indexOf(this._offlineEventListener);s!==-1&&Ft.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}};Ie.protocol=Bs;var Kt=class extends Ie{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),s=!1;Ie.priorWebsocketSuccess=!1;let i=()=>{s||(t.send([{type:"ping",data:"probe"}]),t.once("packet",h=>{if(!s)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Ie.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(f(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{let d=new Error("probe error");d.transport=t.name,this.emitReserved("upgradeError",d)}}))};function r(){s||(s=!0,f(),t.close(),t=null)}let o=h=>{let d=new Error("probe error: "+h);d.transport=t.name,r(),this.emitReserved("upgradeError",d)};function a(){o("transport closed")}function c(){o("socket closed")}function l(h){t&&h.name!==t.name&&r()}let f=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",a),this.off("close",c),this.off("upgrading",l)};t.once("open",i),t.once("error",o),t.once("close",a),this.once("close",c),this.once("upgrading",l),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{s||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){let t=[];for(let s=0;s<e.length;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}},Ke=class extends Kt{constructor(e,t={}){let s=typeof e=="object"?e:t;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(i=>$s[i]).filter(i=>!!i)),super(e,s)}};var nc=Ke.protocol;function yi(n,e="",t){let s=n;t=t||typeof location!="undefined"&&location,n==null&&(n=t.protocol+"//"+t.host),typeof n=="string"&&(n.charAt(0)==="/"&&(n.charAt(1)==="/"?n=t.protocol+n:n=t.host+n),/^(https?|wss?):\/\//.test(n)||(typeof t!="undefined"?n=t.protocol+"//"+n:n="https://"+n),s=Fe(n)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";let r=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+r+":"+s.port+e,s.href=s.protocol+"://"+r+(t&&t.port===s.port?"":":"+s.port),s}var Ys={};Rn(Ys,{Decoder:()=>Vs,Encoder:()=>Us,PacketType:()=>A,protocol:()=>ki});var Wr=typeof ArrayBuffer=="function",Hr=n=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(n):n.buffer instanceof ArrayBuffer,bi=Object.prototype.toString,zr=typeof Blob=="function"||typeof Blob!="undefined"&&bi.call(Blob)==="[object BlobConstructor]",Jr=typeof File=="function"||typeof File!="undefined"&&bi.call(File)==="[object FileConstructor]";function lt(n){return Wr&&(n instanceof ArrayBuffer||Hr(n))||zr&&n instanceof Blob||Jr&&n instanceof File}function ct(n,e){if(!n||typeof n!="object")return!1;if(Array.isArray(n)){for(let t=0,s=n.length;t<s;t++)if(ct(n[t]))return!0;return!1}if(lt(n))return!0;if(n.toJSON&&typeof n.toJSON=="function"&&arguments.length===1)return ct(n.toJSON(),!0);for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)&&ct(n[t]))return!0;return!1}function wi(n){let e=[],t=n.data,s=n;return s.data=Fs(t,e),s.attachments=e.length,{packet:s,buffers:e}}function Fs(n,e){if(!n)return n;if(lt(n)){let t={_placeholder:!0,num:e.length};return e.push(n),t}else if(Array.isArray(n)){let t=new Array(n.length);for(let s=0;s<n.length;s++)t[s]=Fs(n[s],e);return t}else if(typeof n=="object"&&!(n instanceof Date)){let t={};for(let s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=Fs(n[s],e));return t}return n}function vi(n,e){return n.data=Ks(n.data,e),delete n.attachments,n}function Ks(n,e){if(!n)return n;if(n&&n._placeholder===!0){if(typeof n.num=="number"&&n.num>=0&&n.num<e.length)return e[n.num];throw new Error("illegal attachments")}else if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t]=Ks(n[t],e);else if(typeof n=="object")for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&(n[t]=Ks(n[t],e));return n}var Gr=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],ki=5,A;(function(n){n[n.CONNECT=0]="CONNECT",n[n.DISCONNECT=1]="DISCONNECT",n[n.EVENT=2]="EVENT",n[n.ACK=3]="ACK",n[n.CONNECT_ERROR=4]="CONNECT_ERROR",n[n.BINARY_EVENT=5]="BINARY_EVENT",n[n.BINARY_ACK=6]="BINARY_ACK"})(A||(A={}));var Us=class{constructor(e){this.replacer=e}encode(e){return(e.type===A.EVENT||e.type===A.ACK)&&ct(e)?this.encodeAsBinary({type:e.type===A.EVENT?A.BINARY_EVENT:A.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===A.BINARY_EVENT||e.type===A.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){let t=wi(e),s=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(s),i}};function Si(n){return Object.prototype.toString.call(n)==="[object Object]"}var Vs=class n extends L{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);let s=t.type===A.BINARY_EVENT;s||t.type===A.BINARY_ACK?(t.type=s?A.EVENT:A.ACK,this.reconstructor=new js(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(lt(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0,s={type:Number(e.charAt(0))};if(A[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===A.BINARY_EVENT||s.type===A.BINARY_ACK){let r=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);let o=e.substring(r,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");s.attachments=Number(o)}if(e.charAt(t+1)==="/"){let r=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););s.nsp=e.substring(r,t)}else s.nsp="/";let i=e.charAt(t+1);if(i!==""&&Number(i)==i){let r=t+1;for(;++t;){let o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}s.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){let r=this.tryParse(e.substr(t));if(n.isPayloadValid(s.type,r))s.data=r;else throw new Error("invalid payload")}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case A.CONNECT:return Si(t);case A.DISCONNECT:return t===void 0;case A.CONNECT_ERROR:return typeof t=="string"||Si(t);case A.EVENT:case A.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&Gr.indexOf(t[0])===-1);case A.ACK:case A.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}},js=class{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){let t=vi(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}};function Y(n,e,t){return n.on(e,t),function(){n.off(e,t)}}var Qr=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1}),Ue=class extends L{constructor(e,t,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;let e=this.io;this.subs=[Y(e,"open",this.onopen.bind(this)),Y(e,"packet",this.onpacket.bind(this)),Y(e,"error",this.onerror.bind(this)),Y(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var s,i,r;if(Qr.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;let o={type:A.EVENT,data:t};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){let f=this.ids++,h=t.pop();this._registerAckCallback(f,h),o.id=f}let a=(i=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||i===void 0?void 0:i.writable,c=this.connected&&!(!((r=this.io.engine)===null||r===void 0)&&r._hasPingExpired());return this.flags.volatile&&!a||(c?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var s;let i=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}let r=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);t.call(this,new Error("operation has timed out"))},i),o=(...a)=>{this.io.clearTimeoutFn(r),t.apply(this,a)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((s,i)=>{let r=(o,a)=>o?i(o):s(a);r.withError=!0,t.push(r),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());let s={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...r)=>s!==this._queue[0]?void 0:(i!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...r)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;let t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:A.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(s=>String(s.id)===e)){let s=this.acks[e];delete this.acks[e],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case A.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case A.EVENT:case A.BINARY_EVENT:this.onevent(e);break;case A.ACK:case A.BINARY_ACK:this.onack(e);break;case A.DISCONNECT:this.ondisconnect();break;case A.CONNECT_ERROR:this.destroy();let s=new Error(e.data.message);s.data=e.data.data,this.emitReserved("connect_error",s);break}}onevent(e){let t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){let t=this._anyListeners.slice();for(let s of t)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){let t=this,s=!1;return function(...i){s||(s=!0,t.packet({type:A.ACK,id:e,data:i}))}}onack(e){let t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:A.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){let t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){let t=this._anyOutgoingListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){let t=this._anyOutgoingListeners.slice();for(let s of t)s.apply(this,e.data)}}};function Le(n){n=n||{},this.ms=n.min||100,this.max=n.max||1e4,this.factor=n.factor||2,this.jitter=n.jitter>0&&n.jitter<=1?n.jitter:0,this.attempts=0}Le.prototype.duration=function(){var n=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*n);n=Math.floor(e*10)&1?n+t:n-t}return Math.min(n,this.max)|0};Le.prototype.reset=function(){this.attempts=0};Le.prototype.setMin=function(n){this.ms=n};Le.prototype.setMax=function(n){this.max=n};Le.prototype.setJitter=function(n){this.jitter=n};var Ve=class extends L{constructor(e,t){var s;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,me(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((s=t.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new Le({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;let i=t.parser||Ys;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Ke(this.uri,this.opts);let t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;let i=Y(t,"open",function(){s.onopen(),e&&e()}),r=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=Y(t,"error",r);if(this._timeout!==!1){let a=this._timeout,c=this.setTimeoutFn(()=>{i(),r(new Error("timeout")),t.close()},a);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");let e=this.engine;this.subs.push(Y(e,"ping",this.onping.bind(this)),Y(e,"data",this.ondata.bind(this)),Y(e,"error",this.onerror.bind(this)),Y(e,"close",this.onclose.bind(this)),Y(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){pe(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new Ue(this,e,t),this.nsps[e]=s),s}_destroy(e){let t=Object.keys(this.nsps);for(let s of t)if(this.nsps[s].active)return;this._close()}_packet(e){let t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;let e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{let t=this.backoff.duration();this._reconnecting=!0;let s=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){let e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}};var ft={};function ut(n,e){typeof n=="object"&&(e=n,n=void 0),e=e||{};let t=yi(n,e.path||"/socket.io"),s=t.source,i=t.id,r=t.path,o=ft[i]&&r in ft[i].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o,c;return a?c=new Ve(s,e):(ft[i]||(ft[i]=new Ve(s,e)),c=ft[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(ut,{Manager:Ve,Socket:Ue,io:ut,connect:ut});var Ei=require("obsidian"),Ut=class extends Ei.Events{constructor(){super()}on(e,t){return super.on(e,t)}trigger(e,...t){return super.trigger(e,...t)}};var Ws=n=>{let e=[];for(let t=0;t<n;t++)e.push((16*Math.random()|0).toString(16));return e.join("")};var Ni=async(n,e,t,s,i)=>{if(!n)return;let r=n.getData();r&&(n.importData({edges:[...r.edges,{...i,id:e,fromNode:t.node.id,fromSide:t.side,toNode:s.node.id,toSide:s.side}],nodes:r.nodes}),await n.requestFrame())};var ht=10,Xr=5,Hs=250;function Zr(n,e,t){let s=Array.from(n.nodes.values());for(let i of s){let r=e.x-ht,o=e.x+e.width+ht,a=e.y-ht,c=e.y+e.height+ht,l=i.x,f=i.x+i.width,h=i.y,d=i.y+i.height,p=!(o<=l||r>=f),g=!(c<=h||a>=d);if(p&&g)return!0}return!1}function eo(n,e,t){let s=Array.from(n.nodes.values()),i=new Set((t==null?void 0:t.map(o=>o.id))||[]),r=0;for(let o of s){if(i.has(o.id))continue;let a={x:e.x+e.width/2,y:e.y+e.height/2},c={x:o.x+o.width/2,y:o.y+o.height/2},l=Math.sqrt(Math.pow(a.x-c.x,2)+Math.pow(a.y-c.y,2)),f=(e.width+o.width)/2+(e.height+o.height)/2+ht*2;l<f&&(r+=(f-l)/f*100)}return r}function to(n){let e=(n%360+360)%360;return e>=315||e<45?"right":e>=45&&e<135?"bottom":e>=135&&e<225?"left":"top"}function so(n,e,t,s){if(e.length===0)throw new Error("At least one parent node is required");let i=[],r=1,o=50,a=3;for(console.log(`Starting search with diameter: ${Math.round(Hs)}px, base radius: ${Math.round(Hs)}px`);i.length===0&&r<=o;){let l=[];for(let f=0;f<a&&r+f<=o;f++){let h=r+f,d=Hs*h;l.push(d)}console.log(`Searching batch ${r} with radii: ${l.map(f=>Math.round(f)).join(", ")}px`);for(let f of e){let h={x:f.x+f.width/2,y:f.y+f.height/2};for(let d of l)for(let p=0;p<360;p+=Xr){let g=p*Math.PI/180,u=h.x+Math.cos(g)*d,m=h.y+Math.sin(g)*d,y={x:u-t/2,y:m-s/2,width:t,height:s};if(!Zr(n,y,e)){let b=eo(n,y,e),E=Math.sqrt(Math.pow(u-h.x,2)+Math.pow(m-h.y,2)),k={position:y,parentNode:f,side:to(p),radius:d,angle:p,distanceFromParent:E,collisionScore:b};i.push(k)}}}if(r+=a,i.length>0){console.log(`Found ${i.length} candidate positions after ${r} radii checks`);break}}if(i.length===0)throw new Error(`No safe positions found even after checking ${r} radii (limit: ${o})`);i.sort((l,f)=>l.collisionScore!==f.collisionScore?l.collisionScore-f.collisionScore:l.radius!==f.radius?l.radius-f.radius:l.distanceFromParent-f.distanceFromParent);let c=i[0];return console.log(`Selected best position: radius=${Math.round(c.radius)}px, angle=${c.angle}\xB0, collision_score=${c.collisionScore.toFixed(2)}`),{position:c.position,bestParent:c.parentNode,side:c.side}}function no(n,e,t){let s=Array.from(n.nodes.values());if(s.length===0)return{x:100,y:100,width:e,height:t};let i=-1/0,r=-1/0;return s.forEach(o=>{i=Math.max(i,o.x+o.width),r=Math.max(r,o.y+o.height)}),{x:i+100,y:r+100,width:e,height:t}}var zs=async(n,e,t,s,i)=>{var g,u,m,y;if(console.log("createNode with new exhaustive algorithm",n,e,t,s,i),!e||e.length===0)throw new Error("At least one parent node is required");let r=e[0].color,o=(u=(g=t==null?void 0:t.size)==null?void 0:g.width)!=null?u:300,a=(y=(m=t==null?void 0:t.size)==null?void 0:m.height)!=null?y:300,c;try{c=so(n,e,o,a)}catch(b){console.error("Exhaustive search failed, using emergency positioning:",b),c={position:no(n,o,a),bestParent:e[0],side:"right"}}let{position:l,bestParent:f,side:h}=c,d=n.createTextNode({pos:{x:l.x,y:l.y},size:{height:l.height,width:l.width},text:t==null?void 0:t.text,focus:!1});r&&(d.color=r),s&&d.setData(s),n.deselectAll(),n.addNode(d);let p=e.map(async b=>{let E=Ws(16),k={x:b.x+b.width/2,y:b.y+b.height/2},S={x:d.x+d.width/2,y:d.y+d.height/2},C=S.x-k.x,P=S.y-k.y,w,O;Math.abs(C)>Math.abs(P)?C>0?(w="right",O="left"):(w="left",O="right"):P>0?(w="bottom",O="top"):(w="top",O="bottom");let I={...i,color:r};return await Ni(n,E,{side:w,node:b},{side:O,node:d},I),E});return await Promise.all(p),n.requestSave(),d};var Ci=require("obsidian");function Js(n){return(n==null?void 0:n.getViewType())==="canvas"}function io(n){let e=n.workspace.getActiveViewOfType(Ci.ItemView);if(Js(e))return e;let t=n.workspace.getLeavesOfType("canvas");if(t.length===0)return null;if(t.length===1){let s=t[0].view;return Js(s)?s:null}for(let s of t){let i=s.view;if(Js(i))return i}return null}function G(n){var t;let e=io(n);return(t=e==null?void 0:e.canvas)!=null?t:null}function dt(n,e){let t=Object.keys(e).map(s=>ro(n,s,e[s]));return t.length===1?t[0]:function(){t.forEach(s=>s())}}function ro(n,e,t){let s=n[e],i=n.hasOwnProperty(e),r=i?s:function(){return Object.getPrototypeOf(n)[e].apply(this,arguments)},o=t(r);return s&&Object.setPrototypeOf(o,s),Object.setPrototypeOf(a,o),n[e]=a,c;function a(...l){return o===r&&n[e]===a&&c(),o.apply(this,l)}function c(){n[e]===a&&(i?n[e]=r:delete n[e]),o!==r&&(o=r,Object.setPrototypeOf(a,s||Function))}}var Gs=new WeakSet,Ai=new WeakSet,_i=new WeakSet,Vt=new WeakSet,oo=(n,e)=>{if(!e.menu)return!1;let t=e.menu.constructor.prototype;return Ai.has(t)||(n.register(dt(t,{render:s=>function(...i){let r=s.call(this,...i);if(this.menuEl.children.length===0||this.canvas.selection.size!==1)return r;let o=this.canvas.selection.values().next().value;return Object.prototype.hasOwnProperty.call(o,"path")||Object.prototype.hasOwnProperty.call(o,"bgPath")||n.events.trigger("canvas:node-menu",this,this.canvas,o),r}})),Ai.add(t)),!0},ao=(n,e)=>{if(Gs.has(e))return!0;let t=Object.getPrototypeOf(e);return n.register(dt(t,{addNode(s){return function(...i){return s.call(this,...i)}},addEdge:s=>function(...i){var r,o;return i[0].color=(o=(r=i[0].from)==null?void 0:r.node)==null?void 0:o.color,s.call(this,...i)},showCreationMenu:s=>function(...i){let r=i[0],o=i[1];return n.events.trigger("canvas:creation-menu",r,e,o),s.call(this,...i)}})),Gs.add(e),!0},co=(n,e)=>e.nodes.size===0?(Vt.has(e)||(lo(n,e),Vt.add(e)),!1):Ti(n,e),lo=(n,e)=>{if(!Gs.has(e)){let t=Object.getPrototypeOf(e);n.register(dt(t,{addNode(s){return function(...i){let r=s.call(this,...i);return Vt.has(this)&&setTimeout(()=>{Ti(n,this)&&Vt.delete(this)},0),r}}}))}},Ti=(n,e)=>{let t=e.nodes;if(t.size===0)return!1;let s=Object.getPrototypeOf(t.values().next().value);return _i.has(s)||(n.register(dt(s,{render:i=>function(...r){let o=i.call(this,...r),a=this;return this.nodeEl.getAttribute("data-patched")!==null||this.nodeEl.setAttribute("data-patched","true"),o},showMenu:i=>function(...r){let o=r[0],a=this;return o.addSeparator(),o.addItem(c=>{c.setTitle("Split list to notes"),c.setIcon("lucide-list"),c.onClick(()=>{})}),i.call(this,...r)}})),_i.add(s)),!0},Qs=n=>{console.log("patching all");let e=G(n.app);if(!e)return!1;let t=oo(n,e),s=ao(n,e),i=co(n,e);return t&&s&&i},xi=()=>{console.log("cleaning up patches")};var zt=require("obsidian");var al=Or(require("electron")),Ht=require("obsidian");function fo(n,e,t,s){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function a(f){try{l(s.next(f))}catch(h){o(h)}}function c(f){try{l(s.throw(f))}catch(h){o(h)}}function l(f){f.done?r(f.value):i(f.value).then(a,c)}l((s=s.apply(n,e||[])).next())})}var uo=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/i,Oi="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36,gzip(gfe)",ho=/<text start="([^"]*)" dur="([^"]*)">([^<]*)<\/text>/g,Ne=class extends Error{constructor(e){super(`[YoutubeTranscript] \u{1F6A8} ${e}`)}},Xs=class extends Ne{constructor(){super("YouTube is receiving too many requests from this IP and now requires solving a captcha to continue")}},Zs=class extends Ne{constructor(e){super(`The video is no longer available (${e})`)}},jt=class extends Ne{constructor(e){super(`Transcript is disabled on this video (${e})`)}},Yt=class extends Ne{constructor(e){super(`No transcripts are available for this video (${e})`)}},en=class extends Ne{constructor(e,t,s){super(`No transcripts are available in ${e} this video (${s}). Available languages: ${t.join(", ")}`)}},Wt=class{static fetchTranscript(e,t){var s;return fo(this,void 0,void 0,function*(){let i=this.retrieveVideoId(e),o=yield(yield fetch(`https://www.youtube.com/watch?v=${i}`,{headers:Object.assign(Object.assign({},(t==null?void 0:t.lang)&&{"Accept-Language":t.lang}),{"User-Agent":Oi})})).text(),a=o.split('"captions":');if(a.length<=1)throw o.includes('class="g-recaptcha"')?new Xs:o.includes('"playabilityStatus":')?new jt(e):new Zs(e);let c=(s=(()=>{try{return JSON.parse(a[1].split(',"videoDetails')[0].replace(`
`,""))}catch(p){return}})())===null||s===void 0?void 0:s.playerCaptionsTracklistRenderer;if(!c)throw new jt(e);if(!("captionTracks"in c))throw new Yt(e);if(t!=null&&t.lang&&!c.captionTracks.some(p=>p.languageCode===(t==null?void 0:t.lang)))throw new en(t==null?void 0:t.lang,c.captionTracks.map(p=>p.languageCode),e);let l=(t!=null&&t.lang?c.captionTracks.find(p=>p.languageCode===(t==null?void 0:t.lang)):c.captionTracks[0]).baseUrl,f=yield fetch(l,{headers:Object.assign(Object.assign({},(t==null?void 0:t.lang)&&{"Accept-Language":t.lang}),{"User-Agent":Oi})});if(!f.ok)throw new Yt(e);return[...(yield f.text()).matchAll(ho)].map(p=>{var g;return{text:p[3],duration:parseFloat(p[2]),offset:parseFloat(p[1]),lang:(g=t==null?void 0:t.lang)!==null&&g!==void 0?g:c.captionTracks[0].languageCode}})})}static retrieveVideoId(e){if(e.length===11)return e;let t=e.match(uo);if(t&&t.length)return t[1];throw new Ne("Impossible to retrieve Youtube video ID.")}};async function Pi(n){var t;let e=(t=n.match(/(?:https?:\/\/)?(?:www\.)?youtube\.com\/watch\?v=([^&]+)/))==null?void 0:t[1];if(!e)throw new Error("Failed to get YouTube ID");try{return(await Wt.fetchTranscript(e)).reduce((i,r)=>i+r.text+`
`,"")}catch(s){return console.error("Error fetching YouTube transcript:",s),"Transcript service is currently unavailable. Please try again later."}}async function po(n,e,t){var i;let s=await n.vault.read(e);if(t){let r=n.metadataCache.getFileCache(e);if(r){let o=(0,Ht.resolveSubpath)(r,t);if(!o)return console.warn("Failed to get subpath",{file:e,subpath:t}),s;if(o.start||o.end){let a=s.slice(o.start.offset,(i=o.end)==null?void 0:i.offset);return a||(console.warn("Failed to get subpath",{file:e,subpath:t}),s)}}}return s}async function mo(n){return await n.executeJavaScript("document.body.innerText")}async function go(n){return await Pi(n)}async function Ii(n){let e=n.app,t=n.getData();switch(t.type){case"text":return t.text;case"file":{let s=e.vault.getAbstractFileByPath(t.file);if(s instanceof Ht.TFile){let i=await e.vault.read(s);return n.subpath?await po(e,s,t.subpath):`## ${s.basename}
${i}`}throw new Error("Failed to get file content")}case"link":{let s;if(t.url.includes("youtube.com"))s=await go(t.url);else{let r=n.nodeEl.querySelector("webview");r&&(s=await mo(r))}return s!=null?s:t.url}}}var Li=async(n,e,t,s,i,r)=>{let o=r.find(d=>d.modelId===i);if(!o){new zt.Notice("Error: Active model not found. Please check plugin settings.");return}if(!o.apiKey){new zt.Notice(`Error: API Key for ${o.modelName} is missing. Please set it in plugin settings.`);return}let a=s.getData(),c=[];for(let[d,p]of s.nodes){let g=await Ii(p);c.push({id:d,position:{x:p.x,y:p.y},size:{width:p.width,height:p.height},text:g!=null?g:""})}let l={nodes:c,edges:a.edges.map(d=>{var p;return{label:(p=d.label)!=null?p:"",from:{nodeId:d.fromNode,side:d.fromSide},to:{nodeId:d.toNode,side:d.toSide}}})},f=Array.from(s.selection).map(d=>({nodeId:d.id})),h={apiKey:o.apiKey,modelName:o.modelId};try{await $n(n,f,l,e,t,h)}catch(d){new zt.Notice("Failed to generate AI content: "+d)}};var Jt=Symbol.for("yaml.alias"),Gt=Symbol.for("yaml.document"),Q=Symbol.for("yaml.map"),tn=Symbol.for("yaml.pair"),W=Symbol.for("yaml.scalar"),ye=Symbol.for("yaml.seq"),V=Symbol.for("yaml.node.type"),H=n=>!!n&&typeof n=="object"&&n[V]===Jt,oe=n=>!!n&&typeof n=="object"&&n[V]===Gt,X=n=>!!n&&typeof n=="object"&&n[V]===Q,_=n=>!!n&&typeof n=="object"&&n[V]===tn,N=n=>!!n&&typeof n=="object"&&n[V]===W,Z=n=>!!n&&typeof n=="object"&&n[V]===ye;function x(n){if(n&&typeof n=="object")switch(n[V]){case Q:case ye:return!0}return!1}function T(n){if(n&&typeof n=="object")switch(n[V]){case Jt:case Q:case W:case ye:return!0}return!1}var Qt=n=>(N(n)||x(n))&&!!n.anchor;var j=Symbol("break visit"),Bi=Symbol("skip children"),ae=Symbol("remove node");function ce(n,e){let t=Mi(e);oe(n)?je(null,n.contents,t,Object.freeze([n]))===ae&&(n.contents=null):je(null,n,t,Object.freeze([]))}ce.BREAK=j;ce.SKIP=Bi;ce.REMOVE=ae;function je(n,e,t,s){let i=Ri(n,e,t,s);if(T(i)||_(i))return Di(n,s,i),je(n,i,t,s);if(typeof i!="symbol"){if(x(e)){s=Object.freeze(s.concat(e));for(let r=0;r<e.items.length;++r){let o=je(r,e.items[r],t,s);if(typeof o=="number")r=o-1;else{if(o===j)return j;o===ae&&(e.items.splice(r,1),r-=1)}}}else if(_(e)){s=Object.freeze(s.concat(e));let r=je("key",e.key,t,s);if(r===j)return j;r===ae&&(e.key=null);let o=je("value",e.value,t,s);if(o===j)return j;o===ae&&(e.value=null)}}return i}async function Xt(n,e){let t=Mi(e);oe(n)?await Ye(null,n.contents,t,Object.freeze([n]))===ae&&(n.contents=null):await Ye(null,n,t,Object.freeze([]))}Xt.BREAK=j;Xt.SKIP=Bi;Xt.REMOVE=ae;async function Ye(n,e,t,s){let i=await Ri(n,e,t,s);if(T(i)||_(i))return Di(n,s,i),Ye(n,i,t,s);if(typeof i!="symbol"){if(x(e)){s=Object.freeze(s.concat(e));for(let r=0;r<e.items.length;++r){let o=await Ye(r,e.items[r],t,s);if(typeof o=="number")r=o-1;else{if(o===j)return j;o===ae&&(e.items.splice(r,1),r-=1)}}}else if(_(e)){s=Object.freeze(s.concat(e));let r=await Ye("key",e.key,t,s);if(r===j)return j;r===ae&&(e.key=null);let o=await Ye("value",e.value,t,s);if(o===j)return j;o===ae&&(e.value=null)}}return i}function Mi(n){return typeof n=="object"&&(n.Collection||n.Node||n.Value)?Object.assign({Alias:n.Node,Map:n.Node,Scalar:n.Node,Seq:n.Node},n.Value&&{Map:n.Value,Scalar:n.Value,Seq:n.Value},n.Collection&&{Map:n.Collection,Seq:n.Collection},n):n}function Ri(n,e,t,s){var i,r,o,a,c;if(typeof t=="function")return t(n,e,s);if(X(e))return(i=t.Map)==null?void 0:i.call(t,n,e,s);if(Z(e))return(r=t.Seq)==null?void 0:r.call(t,n,e,s);if(_(e))return(o=t.Pair)==null?void 0:o.call(t,n,e,s);if(N(e))return(a=t.Scalar)==null?void 0:a.call(t,n,e,s);if(H(e))return(c=t.Alias)==null?void 0:c.call(t,n,e,s)}function Di(n,e,t){let s=e[e.length-1];if(x(s))s.items[n]=t;else if(_(s))n==="key"?s.key=t:s.value=t;else if(oe(s))s.contents=t;else{let i=H(s)?"alias":"scalar";throw new Error(`Cannot replace node with ${i} parent`)}}var yo={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"},bo=n=>n.replace(/[!,[\]{}]/g,e=>yo[e]),le=class n{constructor(e,t){this.docStart=null,this.docEnd=!1,this.yaml=Object.assign({},n.defaultYaml,e),this.tags=Object.assign({},n.defaultTags,t)}clone(){let e=new n(this.yaml,this.tags);return e.docStart=this.docStart,e}atDocument(){let e=new n(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:n.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},n.defaultTags);break}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:n.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},n.defaultTags),this.atNextDocument=!1);let s=e.trim().split(/[ \t]+/),i=s.shift();switch(i){case"%TAG":{if(s.length!==2&&(t(0,"%TAG directive should contain exactly two parts"),s.length<2))return!1;let[r,o]=s;return this.tags[r]=o,!0}case"%YAML":{if(this.yaml.explicit=!0,s.length!==1)return t(0,"%YAML directive should contain exactly one part"),!1;let[r]=s;if(r==="1.1"||r==="1.2")return this.yaml.version=r,!0;{let o=/^\d+\.\d+$/.test(r);return t(6,`Unsupported YAML version ${r}`,o),!1}}default:return t(0,`Unknown directive ${i}`,!0),!1}}tagName(e,t){if(e==="!")return"!";if(e[0]!=="!")return t(`Not a valid tag: ${e}`),null;if(e[1]==="<"){let o=e.slice(2,-1);return o==="!"||o==="!!"?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(e[e.length-1]!==">"&&t("Verbatim tags must end with a >"),o)}let[,s,i]=e.match(/^(.*!)([^!]*)$/s);i||t(`The ${e} tag has no suffix`);let r=this.tags[s];if(r)try{return r+decodeURIComponent(i)}catch(o){return t(String(o)),null}return s==="!"?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(let[t,s]of Object.entries(this.tags))if(e.startsWith(s))return t+bo(e.substring(s.length));return e[0]==="!"?e:`!<${e}>`}toString(e){let t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],s=Object.entries(this.tags),i;if(e&&s.length>0&&T(e.contents)){let r={};ce(e.contents,(o,a)=>{T(a)&&a.tag&&(r[a.tag]=!0)}),i=Object.keys(r)}else i=[];for(let[r,o]of s)r==="!!"&&o==="tag:yaml.org,2002:"||(!e||i.some(a=>a.startsWith(o)))&&t.push(`%TAG ${r} ${o}`);return t.join(`
`)}};le.defaultYaml={explicit:!1,version:"1.2"};le.defaultTags={"!!":"tag:yaml.org,2002:"};function Zt(n){if(/[\x00-\x19\s,[\]{}]/.test(n)){let t=`Anchor must not contain whitespace or control characters: ${JSON.stringify(n)}`;throw new Error(t)}return!0}function sn(n){let e=new Set;return ce(n,{Value(t,s){s.anchor&&e.add(s.anchor)}}),e}function nn(n,e){for(let t=1;;++t){let s=`${n}${t}`;if(!e.has(s))return s}}function $i(n,e){let t=[],s=new Map,i=null;return{onAnchor:r=>{t.push(r),i!=null||(i=sn(n));let o=nn(e,i);return i.add(o),o},setAnchors:()=>{for(let r of t){let o=s.get(r);if(typeof o=="object"&&o.anchor&&(N(o.node)||x(o.node)))o.node.anchor=o.anchor;else{let a=new Error("Failed to resolve repeated object (this should not happen)");throw a.source=r,a}}},sourceObjects:s}}function Ce(n,e,t,s){if(s&&typeof s=="object")if(Array.isArray(s))for(let i=0,r=s.length;i<r;++i){let o=s[i],a=Ce(n,s,String(i),o);a===void 0?delete s[i]:a!==o&&(s[i]=a)}else if(s instanceof Map)for(let i of Array.from(s.keys())){let r=s.get(i),o=Ce(n,s,i,r);o===void 0?s.delete(i):o!==r&&s.set(i,o)}else if(s instanceof Set)for(let i of Array.from(s)){let r=Ce(n,s,i,i);r===void 0?s.delete(i):r!==i&&(s.delete(i),s.add(r))}else for(let[i,r]of Object.entries(s)){let o=Ce(n,s,i,r);o===void 0?delete s[i]:o!==r&&(s[i]=o)}return n.call(e,t,s)}function $(n,e,t){if(Array.isArray(n))return n.map((s,i)=>$(s,String(i),t));if(n&&typeof n.toJSON=="function"){if(!t||!Qt(n))return n.toJSON(e,t);let s={aliasCount:0,count:1,res:void 0};t.anchors.set(n,s),t.onCreate=r=>{s.res=r,delete t.onCreate};let i=n.toJSON(e,t);return t.onCreate&&t.onCreate(i),i}return typeof n=="bigint"&&!(t!=null&&t.keep)?Number(n):n}var Ae=class{constructor(e){Object.defineProperty(this,V,{value:e})}clone(){let e=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return this.range&&(e.range=this.range.slice()),e}toJS(e,{mapAsMap:t,maxAliasCount:s,onAnchor:i,reviver:r}={}){if(!oe(e))throw new TypeError("A document argument is required");let o={anchors:new Map,doc:e,keep:!0,mapAsMap:t===!0,mapKeyWarned:!1,maxAliasCount:typeof s=="number"?s:100},a=$(this,"",o);if(typeof i=="function")for(let{count:c,res:l}of o.anchors.values())i(l,c);return typeof r=="function"?Ce(r,{"":a},"",a):a}};var be=class extends Ae{constructor(e){super(Jt),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}resolve(e,t){let s;t!=null&&t.aliasResolveCache?s=t.aliasResolveCache:(s=[],ce(e,{Node:(r,o)=>{(H(o)||Qt(o))&&s.push(o)}}),t&&(t.aliasResolveCache=s));let i;for(let r of s){if(r===this)break;r.anchor===this.source&&(i=r)}return i}toJSON(e,t){if(!t)return{source:this.source};let{anchors:s,doc:i,maxAliasCount:r}=t,o=this.resolve(i,t);if(!o){let c=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new ReferenceError(c)}let a=s.get(o);if(a||($(o,null,t),a=s.get(o)),!a||a.res===void 0){let c="This should not happen: Alias anchor was not resolved?";throw new ReferenceError(c)}if(r>=0&&(a.count+=1,a.aliasCount===0&&(a.aliasCount=es(i,o,s)),a.count*a.aliasCount>r)){let c="Excessive alias count indicates a resource exhaustion attack";throw new ReferenceError(c)}return a.res}toString(e,t,s){let i=`*${this.source}`;if(e){if(Zt(this.source),e.options.verifyAliasOrder&&!e.anchors.has(this.source)){let r=`Unresolved alias (the anchor must be set before the alias): ${this.source}`;throw new Error(r)}if(e.implicitKey)return`${i} `}return i}};function es(n,e,t){if(H(e)){let s=e.resolve(n),i=t&&s&&t.get(s);return i?i.count*i.aliasCount:0}else if(x(e)){let s=0;for(let i of e.items){let r=es(n,i,t);r>s&&(s=r)}return s}else if(_(e)){let s=es(n,e.key,t),i=es(n,e.value,t);return Math.max(s,i)}return 1}var ts=n=>!n||typeof n!="function"&&typeof n!="object",v=class extends Ae{constructor(e){super(W),this.value=e}toJSON(e,t){return t!=null&&t.keep?this.value:$(this.value,e,t)}toString(){return String(this.value)}};v.BLOCK_FOLDED="BLOCK_FOLDED";v.BLOCK_LITERAL="BLOCK_LITERAL";v.PLAIN="PLAIN";v.QUOTE_DOUBLE="QUOTE_DOUBLE";v.QUOTE_SINGLE="QUOTE_SINGLE";var wo="tag:yaml.org,2002:";function vo(n,e,t){var s;if(e){let i=t.filter(o=>o.tag===e),r=(s=i.find(o=>!o.format))!=null?s:i[0];if(!r)throw new Error(`Tag ${e} not found`);return r}return t.find(i=>{var r;return((r=i.identify)==null?void 0:r.call(i,n))&&!i.format})}function we(n,e,t){var h,d,p,g;if(oe(n)&&(n=n.contents),T(n))return n;if(_(n)){let u=(d=(h=t.schema[Q]).createNode)==null?void 0:d.call(h,t.schema,null,t);return u.items.push(n),u}(n instanceof String||n instanceof Number||n instanceof Boolean||typeof BigInt!="undefined"&&n instanceof BigInt)&&(n=n.valueOf());let{aliasDuplicateObjects:s,onAnchor:i,onTagObj:r,schema:o,sourceObjects:a}=t,c;if(s&&n&&typeof n=="object"){if(c=a.get(n),c)return(p=c.anchor)!=null||(c.anchor=i(n)),new be(c.anchor);c={anchor:null,node:null},a.set(n,c)}e!=null&&e.startsWith("!!")&&(e=wo+e.slice(2));let l=vo(n,e,o.tags);if(!l){if(n&&typeof n.toJSON=="function"&&(n=n.toJSON()),!n||typeof n!="object"){let u=new v(n);return c&&(c.node=u),u}l=n instanceof Map?o[Q]:Symbol.iterator in Object(n)?o[ye]:o[Q]}r&&(r(l),delete t.onTagObj);let f=l!=null&&l.createNode?l.createNode(t.schema,n,t):typeof((g=l==null?void 0:l.nodeClass)==null?void 0:g.from)=="function"?l.nodeClass.from(t.schema,n,t):new v(n);return e?f.tag=e:l.default||(f.tag=l.tag),c&&(c.node=f),f}function pt(n,e,t){let s=t;for(let i=e.length-1;i>=0;--i){let r=e[i];if(typeof r=="number"&&Number.isInteger(r)&&r>=0){let o=[];o[r]=s,s=o}else s=new Map([[r,s]])}return we(s,void 0,{aliasDuplicateObjects:!1,keepUndefined:!1,onAnchor:()=>{throw new Error("This should not happen, please report a bug.")},schema:n,sourceObjects:new Map})}var He=n=>n==null||typeof n=="object"&&!!n[Symbol.iterator]().next().done,We=class extends Ae{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}clone(e){let t=Object.create(Object.getPrototypeOf(this),Object.getOwnPropertyDescriptors(this));return e&&(t.schema=e),t.items=t.items.map(s=>T(s)||_(s)?s.clone(e):s),this.range&&(t.range=this.range.slice()),t}addIn(e,t){if(He(e))this.add(t);else{let[s,...i]=e,r=this.get(s,!0);if(x(r))r.addIn(i,t);else if(r===void 0&&this.schema)this.set(s,pt(this.schema,i,t));else throw new Error(`Expected YAML collection at ${s}. Remaining path: ${i}`)}}deleteIn(e){let[t,...s]=e;if(s.length===0)return this.delete(t);let i=this.get(t,!0);if(x(i))return i.deleteIn(s);throw new Error(`Expected YAML collection at ${t}. Remaining path: ${s}`)}getIn(e,t){let[s,...i]=e,r=this.get(s,!0);return i.length===0?!t&&N(r)?r.value:r:x(r)?r.getIn(i,t):void 0}hasAllNullValues(e){return this.items.every(t=>{if(!_(t))return!1;let s=t.value;return s==null||e&&N(s)&&s.value==null&&!s.commentBefore&&!s.comment&&!s.tag})}hasIn(e){let[t,...s]=e;if(s.length===0)return this.has(t);let i=this.get(t,!0);return x(i)?i.hasIn(s):!1}setIn(e,t){let[s,...i]=e;if(i.length===0)this.set(s,t);else{let r=this.get(s,!0);if(x(r))r.setIn(i,t);else if(r===void 0&&this.schema)this.set(s,pt(this.schema,i,t));else throw new Error(`Expected YAML collection at ${s}. Remaining path: ${i}`)}}};var qi=n=>n.replace(/^(?!$)(?: $)?/gm,"#");function z(n,e){return/^\n+$/.test(n)?n.substring(1):e?n.replace(/^(?! *$)/gm,e):n}var fe=(n,e,t)=>n.endsWith(`
`)?z(t,e):t.includes(`
`)?`
`+z(t,e):(n.endsWith(" ")?"":" ")+t;var rn="flow",ss="block",mt="quoted";function gt(n,e,t="flow",{indentAtStart:s,lineWidth:i=80,minContentWidth:r=20,onFold:o,onOverflow:a}={}){if(!i||i<0)return n;i<r&&(r=0);let c=Math.max(1+r,1+i-e.length);if(n.length<=c)return n;let l=[],f={},h=i-e.length;typeof s=="number"&&(s>i-Math.max(2,r)?l.push(0):h=i-s);let d,p,g=!1,u=-1,m=-1,y=-1;t===ss&&(u=Fi(n,u,e.length),u!==-1&&(h=u+c));for(let E;E=n[u+=1];){if(t===mt&&E==="\\"){switch(m=u,n[u+1]){case"x":u+=3;break;case"u":u+=5;break;case"U":u+=9;break;default:u+=1}y=u}if(E===`
`)t===ss&&(u=Fi(n,u,e.length)),h=u+e.length+c,d=void 0;else{if(E===" "&&p&&p!==" "&&p!==`
`&&p!=="	"){let k=n[u+1];k&&k!==" "&&k!==`
`&&k!=="	"&&(d=u)}if(u>=h)if(d)l.push(d),h=d+c,d=void 0;else if(t===mt){for(;p===" "||p==="	";)p=E,E=n[u+=1],g=!0;let k=u>y+1?u-2:m-1;if(f[k])return n;l.push(k),f[k]=!0,h=k+c,d=void 0}else g=!0}p=E}if(g&&a&&a(),l.length===0)return n;o&&o();let b=n.slice(0,l[0]);for(let E=0;E<l.length;++E){let k=l[E],S=l[E+1]||n.length;k===0?b=`
${e}${n.slice(0,S)}`:(t===mt&&f[k]&&(b+=`${n[k]}\\`),b+=`
${e}${n.slice(k+1,S)}`)}return b}function Fi(n,e,t){let s=e,i=e+1,r=n[i];for(;r===" "||r==="	";)if(e<i+t)r=n[++e];else{do r=n[++e];while(r&&r!==`
`);s=e,i=e+1,r=n[i]}return s}var is=(n,e)=>({indentAtStart:e?n.indent.length:n.indentAtStart,lineWidth:n.options.lineWidth,minContentWidth:n.options.minContentWidth}),rs=n=>/^(%|---|\.\.\.)/m.test(n);function So(n,e,t){if(!e||e<0)return!1;let s=e-t,i=n.length;if(i<=s)return!1;for(let r=0,o=0;r<i;++r)if(n[r]===`
`){if(r-o>s)return!0;if(o=r+1,i-o<=s)return!1}return!0}function yt(n,e){let t=JSON.stringify(n);if(e.options.doubleQuotedAsJSON)return t;let{implicitKey:s}=e,i=e.options.doubleQuotedMinMultiLineLength,r=e.indent||(rs(n)?"  ":""),o="",a=0;for(let c=0,l=t[c];l;l=t[++c])if(l===" "&&t[c+1]==="\\"&&t[c+2]==="n"&&(o+=t.slice(a,c)+"\\ ",c+=1,a=c,l="\\"),l==="\\")switch(t[c+1]){case"u":{o+=t.slice(a,c);let f=t.substr(c+2,4);switch(f){case"0000":o+="\\0";break;case"0007":o+="\\a";break;case"000b":o+="\\v";break;case"001b":o+="\\e";break;case"0085":o+="\\N";break;case"00a0":o+="\\_";break;case"2028":o+="\\L";break;case"2029":o+="\\P";break;default:f.substr(0,2)==="00"?o+="\\x"+f.substr(2):o+=t.substr(c,6)}c+=5,a=c+1}break;case"n":if(s||t[c+2]==='"'||t.length<i)c+=1;else{for(o+=t.slice(a,c)+`

`;t[c+2]==="\\"&&t[c+3]==="n"&&t[c+4]!=='"';)o+=`
`,c+=2;o+=r,t[c+2]===" "&&(o+="\\"),c+=1,a=c+1}break;default:c+=1}return o=a?o+t.slice(a):t,s?o:gt(o,r,mt,is(e,!1))}function on(n,e){if(e.options.singleQuote===!1||e.implicitKey&&n.includes(`
`)||/[ \t]\n|\n[ \t]/.test(n))return yt(n,e);let t=e.indent||(rs(n)?"  ":""),s="'"+n.replace(/'/g,"''").replace(/\n+/g,`$&
${t}`)+"'";return e.implicitKey?s:gt(s,t,rn,is(e,!1))}function ze(n,e){let{singleQuote:t}=e.options,s;if(t===!1)s=yt;else{let i=n.includes('"'),r=n.includes("'");i&&!r?s=on:r&&!i?s=yt:s=t?on:yt}return s(n,e)}var an;try{an=new RegExp(`(^|(?<!
))
+(?!
|$)`,"g")}catch(n){an=/\n+(?!\n|$)/g}function ns({comment:n,type:e,value:t},s,i,r){let{blockQuote:o,commentString:a,lineWidth:c}=s.options;if(!o||/\n[\t ]+$/.test(t)||/^\s*$/.test(t))return ze(t,s);let l=s.indent||(s.forceBlockIndent||rs(t)?"  ":""),f=o==="literal"?!0:o==="folded"||e===v.BLOCK_FOLDED?!1:e===v.BLOCK_LITERAL?!0:!So(t,c,l.length);if(!t)return f?`|
`:`>
`;let h,d;for(d=t.length;d>0;--d){let S=t[d-1];if(S!==`
`&&S!=="	"&&S!==" ")break}let p=t.substring(d),g=p.indexOf(`
`);g===-1?h="-":t===p||g!==p.length-1?(h="+",r&&r()):h="",p&&(t=t.slice(0,-p.length),p[p.length-1]===`
`&&(p=p.slice(0,-1)),p=p.replace(an,`$&${l}`));let u=!1,m,y=-1;for(m=0;m<t.length;++m){let S=t[m];if(S===" ")u=!0;else if(S===`
`)y=m;else break}let b=t.substring(0,y<m?y+1:m);b&&(t=t.substring(b.length),b=b.replace(/\n+/g,`$&${l}`));let k=(u?l?"2":"1":"")+h;if(n&&(k+=" "+a(n.replace(/ ?[\r\n]+/g," ")),i&&i()),!f){let S=t.replace(/\n+/g,`
$&`).replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${l}`),C=!1,P=is(s,!0);o!=="folded"&&e!==v.BLOCK_FOLDED&&(P.onOverflow=()=>{C=!0});let w=gt(`${b}${S}${p}`,l,ss,P);if(!C)return`>${k}
${l}${w}`}return t=t.replace(/\n+/g,`$&${l}`),`|${k}
${l}${b}${t}${p}`}function ko(n,e,t,s){let{type:i,value:r}=n,{actualString:o,implicitKey:a,indent:c,indentStep:l,inFlow:f}=e;if(a&&r.includes(`
`)||f&&/[[\]{},]/.test(r))return ze(r,e);if(/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(r))return a||f||!r.includes(`
`)?ze(r,e):ns(n,e,t,s);if(!a&&!f&&i!==v.PLAIN&&r.includes(`
`))return ns(n,e,t,s);if(rs(r)){if(c==="")return e.forceBlockIndent=!0,ns(n,e,t,s);if(a&&c===l)return ze(r,e)}let h=r.replace(/\n+/g,`$&
${c}`);if(o){let d=u=>{var m;return u.default&&u.tag!=="tag:yaml.org,2002:str"&&((m=u.test)==null?void 0:m.test(h))},{compat:p,tags:g}=e.doc.schema;if(g.some(d)||p!=null&&p.some(d))return ze(r,e)}return a?h:gt(h,c,rn,is(e,!1))}function Be(n,e,t,s){let{implicitKey:i,inFlow:r}=e,o=typeof n.value=="string"?n:Object.assign({},n,{value:String(n.value)}),{type:a}=n;a!==v.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(o.value)&&(a=v.QUOTE_DOUBLE);let c=f=>{switch(f){case v.BLOCK_FOLDED:case v.BLOCK_LITERAL:return i||r?ze(o.value,e):ns(o,e,t,s);case v.QUOTE_DOUBLE:return yt(o.value,e);case v.QUOTE_SINGLE:return on(o.value,e);case v.PLAIN:return ko(o,e,t,s);default:return null}},l=c(a);if(l===null){let{defaultKeyType:f,defaultStringType:h}=e.options,d=i&&f||h;if(l=c(d),l===null)throw new Error(`Unsupported default string type ${d}`)}return l}function os(n,e){let t=Object.assign({blockQuote:!0,commentString:qi,defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",flowCollectionPadding:!0,indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:null,trueStr:"true",verifyAliasOrder:!0},n.schema.toStringOptions,e),s;switch(t.collectionStyle){case"block":s=!1;break;case"flow":s=!0;break;default:s=null}return{anchors:new Set,doc:n,flowCollectionPadding:t.flowCollectionPadding?" ":"",indent:"",indentStep:typeof t.indent=="number"?" ".repeat(t.indent):"  ",inFlow:s,options:t}}function Eo(n,e){var i,r,o,a;if(e.tag){let c=n.filter(l=>l.tag===e.tag);if(c.length>0)return(i=c.find(l=>l.format===e.format))!=null?i:c[0]}let t,s;if(N(e)){s=e.value;let c=n.filter(l=>{var f;return(f=l.identify)==null?void 0:f.call(l,s)});if(c.length>1){let l=c.filter(f=>f.test);l.length>0&&(c=l)}t=(r=c.find(l=>l.format===e.format))!=null?r:c.find(l=>!l.format)}else s=e,t=n.find(c=>c.nodeClass&&s instanceof c.nodeClass);if(!t){let c=(a=(o=s==null?void 0:s.constructor)==null?void 0:o.name)!=null?a:s===null?"null":typeof s;throw new Error(`Tag not resolved for ${c} value`)}return t}function No(n,e,{anchors:t,doc:s}){var a;if(!s.directives)return"";let i=[],r=(N(n)||x(n))&&n.anchor;r&&Zt(r)&&(t.add(r),i.push(`&${r}`));let o=(a=n.tag)!=null?a:e.default?null:e.tag;return o&&i.push(s.directives.tagString(o)),i.join(" ")}function ve(n,e,t,s){var c,l;if(_(n))return n.toString(e,t,s);if(H(n)){if(e.doc.directives)return n.toString(e);if((c=e.resolvedAliases)!=null&&c.has(n))throw new TypeError("Cannot stringify circular structure without alias nodes");e.resolvedAliases?e.resolvedAliases.add(n):e.resolvedAliases=new Set([n]),n=n.resolve(e.doc)}let i,r=T(n)?n:e.doc.createNode(n,{onTagObj:f=>i=f});i!=null||(i=Eo(e.doc.schema.tags,r));let o=No(r,i,e);o.length>0&&(e.indentAtStart=((l=e.indentAtStart)!=null?l:0)+o.length+1);let a=typeof i.stringify=="function"?i.stringify(r,e,t,s):N(r)?Be(r,e,t,s):r.toString(e,t,s);return o?N(r)||a[0]==="{"||a[0]==="["?`${o} ${a}`:`${o}
${e.indent}${a}`:a}function Ki({key:n,value:e},t,s,i){var P,w;let{allNullValues:r,doc:o,indent:a,indentStep:c,options:{commentString:l,indentSeq:f,simpleKeys:h}}=t,d=T(n)&&n.comment||null;if(h){if(d)throw new Error("With simple keys, key nodes cannot have comments");if(x(n)||!T(n)&&typeof n=="object"){let O="With simple keys, collection cannot be used as a key value";throw new Error(O)}}let p=!h&&(!n||d&&e==null&&!t.inFlow||x(n)||(N(n)?n.type===v.BLOCK_FOLDED||n.type===v.BLOCK_LITERAL:typeof n=="object"));t=Object.assign({},t,{allNullValues:!1,implicitKey:!p&&(h||!r),indent:a+c});let g=!1,u=!1,m=ve(n,t,()=>g=!0,()=>u=!0);if(!p&&!t.inFlow&&m.length>1024){if(h)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");p=!0}if(t.inFlow){if(r||e==null)return g&&s&&s(),m===""?"?":p?`? ${m}`:m}else if(r&&!h||e==null&&p)return m=`? ${m}`,d&&!g?m+=fe(m,t.indent,l(d)):u&&i&&i(),m;g&&(d=null),p?(d&&(m+=fe(m,t.indent,l(d))),m=`? ${m}
${a}:`):(m=`${m}:`,d&&(m+=fe(m,t.indent,l(d))));let y,b,E;T(e)?(y=!!e.spaceBefore,b=e.commentBefore,E=e.comment):(y=!1,b=null,E=null,e&&typeof e=="object"&&(e=o.createNode(e))),t.implicitKey=!1,!p&&!d&&N(e)&&(t.indentAtStart=m.length+1),u=!1,!f&&c.length>=2&&!t.inFlow&&!p&&Z(e)&&!e.flow&&!e.tag&&!e.anchor&&(t.indent=t.indent.substring(2));let k=!1,S=ve(e,t,()=>k=!0,()=>u=!0),C=" ";if(d||y||b){if(C=y?`
`:"",b){let O=l(b);C+=`
${z(O,t.indent)}`}S===""&&!t.inFlow?C===`
`&&(C=`

`):C+=`
${t.indent}`}else if(!p&&x(e)){let O=S[0],I=S.indexOf(`
`),q=I!==-1,re=(w=(P=t.inFlow)!=null?P:e.flow)!=null?w:e.items.length===0;if(q||!re){let $e=!1;if(q&&(O==="&"||O==="!")){let D=S.indexOf(" ");O==="&"&&D!==-1&&D<I&&S[D+1]==="!"&&(D=S.indexOf(" ",D+1)),(D===-1||I<D)&&($e=!0)}$e||(C=`
${t.indent}`)}}else(S===""||S[0]===`
`)&&(C="");return m+=C+S,t.inFlow?k&&s&&s():E&&!k?m+=fe(m,t.indent,l(E)):u&&i&&i(),m}function as(n,e){(n==="debug"||n==="warn")&&console.warn(e)}var cs="<<",ee={identify:n=>n===cs||typeof n=="symbol"&&n.description===cs,default:"key",tag:"tag:yaml.org,2002:merge",test:/^<<$/,resolve:()=>Object.assign(new v(Symbol(cs)),{addToJSMap:ln}),stringify:()=>cs},Ui=(n,e)=>(ee.identify(e)||N(e)&&(!e.type||e.type===v.PLAIN)&&ee.identify(e.value))&&(n==null?void 0:n.doc.schema.tags.some(t=>t.tag===ee.tag&&t.default));function ln(n,e,t){if(t=n&&H(t)?t.resolve(n.doc):t,Z(t))for(let s of t.items)cn(n,e,s);else if(Array.isArray(t))for(let s of t)cn(n,e,s);else cn(n,e,t)}function cn(n,e,t){let s=n&&H(t)?t.resolve(n.doc):t;if(!X(s))throw new Error("Merge sources must be maps or map aliases");let i=s.toJSON(null,n,Map);for(let[r,o]of i)e instanceof Map?e.has(r)||e.set(r,o):e instanceof Set?e.add(r):Object.prototype.hasOwnProperty.call(e,r)||Object.defineProperty(e,r,{value:o,writable:!0,enumerable:!0,configurable:!0});return e}function ls(n,e,{key:t,value:s}){if(T(t)&&t.addToJSMap)t.addToJSMap(n,e,s);else if(Ui(n,t))ln(n,e,s);else{let i=$(t,"",n);if(e instanceof Map)e.set(i,$(s,i,n));else if(e instanceof Set)e.add(i);else{let r=Co(t,i,n),o=$(s,r,n);r in e?Object.defineProperty(e,r,{value:o,writable:!0,enumerable:!0,configurable:!0}):e[r]=o}}return e}function Co(n,e,t){if(e===null)return"";if(typeof e!="object")return String(e);if(T(n)&&(t!=null&&t.doc)){let s=os(t.doc,{});s.anchors=new Set;for(let r of t.anchors.keys())s.anchors.add(r.anchor);s.inFlow=!0,s.inStringifyKey=!0;let i=n.toString(s);if(!t.mapKeyWarned){let r=JSON.stringify(i);r.length>40&&(r=r.substring(0,36)+'..."'),as(t.doc.options.logLevel,`Keys with collection values will be stringified due to JS Object restrictions: ${r}. Set mapAsMap: true to use object keys.`),t.mapKeyWarned=!0}return i}return JSON.stringify(e)}function Je(n,e,t){let s=we(n,void 0,t),i=we(e,void 0,t);return new M(s,i)}var M=class n{constructor(e,t=null){Object.defineProperty(this,V,{value:tn}),this.key=e,this.value=t}clone(e){let{key:t,value:s}=this;return T(t)&&(t=t.clone(e)),T(s)&&(s=s.clone(e)),new n(t,s)}toJSON(e,t){let s=t!=null&&t.mapAsMap?new Map:{};return ls(t,s,this)}toString(e,t,s){return e!=null&&e.doc?Ki(this,e,t,s):JSON.stringify(this)}};function us(n,e,t){var r;return(((r=e.inFlow)!=null?r:n.flow)?_o:Ao)(n,e,t)}function Ao({comment:n,items:e},t,{blockItemPrefix:s,flowChars:i,itemIndent:r,onChompKeep:o,onComment:a}){let{indent:c,options:{commentString:l}}=t,f=Object.assign({},t,{indent:r,type:null}),h=!1,d=[];for(let g=0;g<e.length;++g){let u=e[g],m=null;if(T(u))!h&&u.spaceBefore&&d.push(""),fs(t,d,u.commentBefore,h),u.comment&&(m=u.comment);else if(_(u)){let b=T(u.key)?u.key:null;b&&(!h&&b.spaceBefore&&d.push(""),fs(t,d,b.commentBefore,h))}h=!1;let y=ve(u,f,()=>m=null,()=>h=!0);m&&(y+=fe(y,r,l(m))),h&&m&&(h=!1),d.push(s+y)}let p;if(d.length===0)p=i.start+i.end;else{p=d[0];for(let g=1;g<d.length;++g){let u=d[g];p+=u?`
${c}${u}`:`
`}}return n?(p+=`
`+z(l(n),c),a&&a()):h&&o&&o(),p}function _o({items:n},e,{flowChars:t,itemIndent:s}){let{indent:i,indentStep:r,flowCollectionPadding:o,options:{commentString:a}}=e;s+=r;let c=Object.assign({},e,{indent:s,inFlow:!0,type:null}),l=!1,f=0,h=[];for(let g=0;g<n.length;++g){let u=n[g],m=null;if(T(u))u.spaceBefore&&h.push(""),fs(e,h,u.commentBefore,!1),u.comment&&(m=u.comment);else if(_(u)){let b=T(u.key)?u.key:null;b&&(b.spaceBefore&&h.push(""),fs(e,h,b.commentBefore,!1),b.comment&&(l=!0));let E=T(u.value)?u.value:null;E?(E.comment&&(m=E.comment),E.commentBefore&&(l=!0)):u.value==null&&(b!=null&&b.comment)&&(m=b.comment)}m&&(l=!0);let y=ve(u,c,()=>m=null);g<n.length-1&&(y+=","),m&&(y+=fe(y,s,a(m))),!l&&(h.length>f||y.includes(`
`))&&(l=!0),h.push(y),f=h.length}let{start:d,end:p}=t;if(h.length===0)return d+p;if(!l){let g=h.reduce((u,m)=>u+m.length+2,2);l=e.options.lineWidth>0&&g>e.options.lineWidth}if(l){let g=d;for(let u of h)g+=u?`
${r}${i}${u}`:`
`;return`${g}
${i}${p}`}else return`${d}${o}${h.join(" ")}${o}${p}`}function fs({indent:n,options:{commentString:e}},t,s,i){if(s&&i&&(s=s.replace(/^\n+/,"")),s){let r=z(e(s),n);t.push(r.trimStart())}}function _e(n,e){let t=N(e)?e.value:e;for(let s of n)if(_(s)&&(s.key===e||s.key===t||N(s.key)&&s.key.value===t))return s}var R=class extends We{static get tagName(){return"tag:yaml.org,2002:map"}constructor(e){super(Q,e),this.items=[]}static from(e,t,s){let{keepUndefined:i,replacer:r}=s,o=new this(e),a=(c,l)=>{if(typeof r=="function")l=r.call(t,c,l);else if(Array.isArray(r)&&!r.includes(c))return;(l!==void 0||i)&&o.items.push(Je(c,l,s))};if(t instanceof Map)for(let[c,l]of t)a(c,l);else if(t&&typeof t=="object")for(let c of Object.keys(t))a(c,t[c]);return typeof e.sortMapEntries=="function"&&o.items.sort(e.sortMapEntries),o}add(e,t){var o;let s;_(e)?s=e:!e||typeof e!="object"||!("key"in e)?s=new M(e,e==null?void 0:e.value):s=new M(e.key,e.value);let i=_e(this.items,s.key),r=(o=this.schema)==null?void 0:o.sortMapEntries;if(i){if(!t)throw new Error(`Key ${s.key} already set`);N(i.value)&&ts(s.value)?i.value.value=s.value:i.value=s.value}else if(r){let a=this.items.findIndex(c=>r(s,c)<0);a===-1?this.items.push(s):this.items.splice(a,0,s)}else this.items.push(s)}delete(e){let t=_e(this.items,e);return t?this.items.splice(this.items.indexOf(t),1).length>0:!1}get(e,t){var r;let s=_e(this.items,e),i=s==null?void 0:s.value;return(r=!t&&N(i)?i.value:i)!=null?r:void 0}has(e){return!!_e(this.items,e)}set(e,t){this.add(new M(e,t),!0)}toJSON(e,t,s){let i=s?new s:t!=null&&t.mapAsMap?new Map:{};t!=null&&t.onCreate&&t.onCreate(i);for(let r of this.items)ls(t,i,r);return i}toString(e,t,s){if(!e)return JSON.stringify(this);for(let i of this.items)if(!_(i))throw new Error(`Map items must all be pairs; found ${JSON.stringify(i)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),us(this,e,{blockItemPrefix:"",flowChars:{start:"{",end:"}"},itemIndent:e.indent||"",onChompKeep:s,onComment:t})}};var te={collection:"map",default:!0,nodeClass:R,tag:"tag:yaml.org,2002:map",resolve(n,e){return X(n)||e("Expected a mapping for this tag"),n},createNode:(n,e,t)=>R.from(n,e,t)};var F=class extends We{static get tagName(){return"tag:yaml.org,2002:seq"}constructor(e){super(ye,e),this.items=[]}add(e){this.items.push(e)}delete(e){let t=hs(e);return typeof t!="number"?!1:this.items.splice(t,1).length>0}get(e,t){let s=hs(e);if(typeof s!="number")return;let i=this.items[s];return!t&&N(i)?i.value:i}has(e){let t=hs(e);return typeof t=="number"&&t<this.items.length}set(e,t){let s=hs(e);if(typeof s!="number")throw new Error(`Expected a valid index, not ${e}.`);let i=this.items[s];N(i)&&ts(t)?i.value=t:this.items[s]=t}toJSON(e,t){let s=[];t!=null&&t.onCreate&&t.onCreate(s);let i=0;for(let r of this.items)s.push($(r,String(i++),t));return s}toString(e,t,s){return e?us(this,e,{blockItemPrefix:"- ",flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  ",onChompKeep:s,onComment:t}):JSON.stringify(this)}static from(e,t,s){let{replacer:i}=s,r=new this(e);if(t&&Symbol.iterator in Object(t)){let o=0;for(let a of t){if(typeof i=="function"){let c=t instanceof Set?a:String(o++);a=i.call(t,c,a)}r.items.push(we(a,void 0,s))}}return r}};function hs(n){let e=N(n)?n.value:n;return e&&typeof e=="string"&&(e=Number(e)),typeof e=="number"&&Number.isInteger(e)&&e>=0?e:null}var se={collection:"seq",default:!0,nodeClass:F,tag:"tag:yaml.org,2002:seq",resolve(n,e){return Z(n)||e("Expected a sequence for this tag"),n},createNode:(n,e,t)=>F.from(n,e,t)};var Te={identify:n=>typeof n=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:n=>n,stringify(n,e,t,s){return e=Object.assign({actualString:!0},e),Be(n,e,t,s)}};var Me={identify:n=>n==null,createNode:()=>new v(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new v(null),stringify:({source:n},e)=>typeof n=="string"&&Me.test.test(n)?n:e.options.nullStr};var bt={identify:n=>typeof n=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:n=>new v(n[0]==="t"||n[0]==="T"),stringify({source:n,value:e},t){if(n&&bt.test.test(n)){let s=n[0]==="t"||n[0]==="T";if(e===s)return n}return e?t.options.trueStr:t.options.falseStr}};function K({format:n,minFractionDigits:e,tag:t,value:s}){if(typeof s=="bigint")return String(s);let i=typeof s=="number"?s:Number(s);if(!isFinite(i))return isNaN(i)?".nan":i<0?"-.inf":".inf";let r=JSON.stringify(s);if(!n&&e&&(!t||t==="tag:yaml.org,2002:float")&&/^\d/.test(r)){let o=r.indexOf(".");o<0&&(o=r.length,r+=".");let a=e-(r.length-o-1);for(;a-- >0;)r+="0"}return r}var ds={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:n=>n.slice(-3).toLowerCase()==="nan"?NaN:n[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:K},ps={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:n=>parseFloat(n),stringify(n){let e=Number(n.value);return isFinite(e)?e.toExponential():K(n)}},ms={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(n){let e=new v(parseFloat(n)),t=n.indexOf(".");return t!==-1&&n[n.length-1]==="0"&&(e.minFractionDigits=n.length-t-1),e},stringify:K};var gs=n=>typeof n=="bigint"||Number.isInteger(n),fn=(n,e,t,{intAsBigInt:s})=>s?BigInt(n):parseInt(n.substring(e),t);function Vi(n,e,t){let{value:s}=n;return gs(s)&&s>=0?t+s.toString(e):K(n)}var ys={identify:n=>gs(n)&&n>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(n,e,t)=>fn(n,2,8,t),stringify:n=>Vi(n,8,"0o")},bs={identify:gs,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(n,e,t)=>fn(n,0,10,t),stringify:K},ws={identify:n=>gs(n)&&n>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(n,e,t)=>fn(n,2,16,t),stringify:n=>Vi(n,16,"0x")};var ji=[te,se,Te,Me,bt,ys,bs,ws,ds,ps,ms];function Yi(n){return typeof n=="bigint"||Number.isInteger(n)}var vs=({value:n})=>JSON.stringify(n),To=[{identify:n=>typeof n=="string",default:!0,tag:"tag:yaml.org,2002:str",resolve:n=>n,stringify:vs},{identify:n=>n==null,createNode:()=>new v(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:vs},{identify:n=>typeof n=="boolean",default:!0,tag:"tag:yaml.org,2002:bool",test:/^true$|^false$/,resolve:n=>n==="true",stringify:vs},{identify:Yi,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(n,e,{intAsBigInt:t})=>t?BigInt(n):parseInt(n,10),stringify:({value:n})=>Yi(n)?n.toString():JSON.stringify(n)},{identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:n=>parseFloat(n),stringify:vs}],xo={default:!0,tag:"",test:/^/,resolve(n,e){return e(`Unresolved plain scalar ${JSON.stringify(n)}`),n}},Wi=[te,se].concat(To,xo);var wt={identify:n=>n instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(n,e){if(typeof atob=="function"){let t=atob(n.replace(/[\n\r]/g,"")),s=new Uint8Array(t.length);for(let i=0;i<t.length;++i)s[i]=t.charCodeAt(i);return s}else return e("This environment does not support reading binary tags; either Buffer or atob is required"),n},stringify({comment:n,type:e,value:t},s,i,r){if(!t)return"";let o=t,a;if(typeof btoa=="function"){let c="";for(let l=0;l<o.length;++l)c+=String.fromCharCode(o[l]);a=btoa(c)}else throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");if(e!=null||(e=v.BLOCK_LITERAL),e!==v.QUOTE_DOUBLE){let c=Math.max(s.options.lineWidth-s.indent.length,s.options.minContentWidth),l=Math.ceil(a.length/c),f=new Array(l);for(let h=0,d=0;h<l;++h,d+=c)f[h]=a.substr(d,c);a=f.join(e===v.BLOCK_LITERAL?`
`:" ")}return Be({comment:n,type:e,value:a},s,i,r)}};function un(n,e){var t;if(Z(n))for(let s=0;s<n.items.length;++s){let i=n.items[s];if(!_(i)){if(X(i)){i.items.length>1&&e("Each pair must have its own sequence indicator");let r=i.items[0]||new M(new v(null));if(i.commentBefore&&(r.key.commentBefore=r.key.commentBefore?`${i.commentBefore}
${r.key.commentBefore}`:i.commentBefore),i.comment){let o=(t=r.value)!=null?t:r.key;o.comment=o.comment?`${i.comment}
${o.comment}`:i.comment}i=r}n.items[s]=_(i)?i:new M(i)}}else e("Expected a sequence for this tag");return n}function hn(n,e,t){let{replacer:s}=t,i=new F(n);i.tag="tag:yaml.org,2002:pairs";let r=0;if(e&&Symbol.iterator in Object(e))for(let o of e){typeof s=="function"&&(o=s.call(e,String(r++),o));let a,c;if(Array.isArray(o))if(o.length===2)a=o[0],c=o[1];else throw new TypeError(`Expected [key, value] tuple: ${o}`);else if(o&&o instanceof Object){let l=Object.keys(o);if(l.length===1)a=l[0],c=o[a];else throw new TypeError(`Expected tuple with one key, not ${l.length} keys`)}else a=o;i.items.push(Je(a,c,t))}return i}var vt={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:un,createNode:hn};var Ge=class n extends F{constructor(){super(),this.add=R.prototype.add.bind(this),this.delete=R.prototype.delete.bind(this),this.get=R.prototype.get.bind(this),this.has=R.prototype.has.bind(this),this.set=R.prototype.set.bind(this),this.tag=n.tag}toJSON(e,t){if(!t)return super.toJSON(e);let s=new Map;t!=null&&t.onCreate&&t.onCreate(s);for(let i of this.items){let r,o;if(_(i)?(r=$(i.key,"",t),o=$(i.value,r,t)):r=$(i,"",t),s.has(r))throw new Error("Ordered maps must not include duplicate keys");s.set(r,o)}return s}static from(e,t,s){let i=hn(e,t,s),r=new this;return r.items=i.items,r}};Ge.tag="tag:yaml.org,2002:omap";var St={collection:"seq",identify:n=>n instanceof Map,nodeClass:Ge,default:!1,tag:"tag:yaml.org,2002:omap",resolve(n,e){let t=un(n,e),s=[];for(let{key:i}of t.items)N(i)&&(s.includes(i.value)?e(`Ordered maps must not include duplicate keys: ${i.value}`):s.push(i.value));return Object.assign(new Ge,t)},createNode:(n,e,t)=>Ge.from(n,e,t)};function Hi({value:n,source:e},t){return e&&(n?dn:pn).test.test(e)?e:n?t.options.trueStr:t.options.falseStr}var dn={identify:n=>n===!0,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new v(!0),stringify:Hi},pn={identify:n=>n===!1,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/,resolve:()=>new v(!1),stringify:Hi};var zi={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF)|\.nan|\.NaN|\.NAN)$/,resolve:n=>n.slice(-3).toLowerCase()==="nan"?NaN:n[0]==="-"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:K},Ji={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:n=>parseFloat(n.replace(/_/g,"")),stringify(n){let e=Number(n.value);return isFinite(e)?e.toExponential():K(n)}},Gi={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(n){let e=new v(parseFloat(n.replace(/_/g,""))),t=n.indexOf(".");if(t!==-1){let s=n.substring(t+1).replace(/_/g,"");s[s.length-1]==="0"&&(e.minFractionDigits=s.length)}return e},stringify:K};var kt=n=>typeof n=="bigint"||Number.isInteger(n);function Ss(n,e,t,{intAsBigInt:s}){let i=n[0];if((i==="-"||i==="+")&&(e+=1),n=n.substring(e).replace(/_/g,""),s){switch(t){case 2:n=`0b${n}`;break;case 8:n=`0o${n}`;break;case 16:n=`0x${n}`;break}let o=BigInt(n);return i==="-"?BigInt(-1)*o:o}let r=parseInt(n,t);return i==="-"?-1*r:r}function mn(n,e,t){let{value:s}=n;if(kt(s)){let i=s.toString(e);return s<0?"-"+t+i.substr(1):t+i}return K(n)}var Qi={identify:kt,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(n,e,t)=>Ss(n,2,2,t),stringify:n=>mn(n,2,"0b")},Xi={identify:kt,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(n,e,t)=>Ss(n,1,8,t),stringify:n=>mn(n,8,"0")},Zi={identify:kt,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(n,e,t)=>Ss(n,0,10,t),stringify:K},er={identify:kt,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(n,e,t)=>Ss(n,2,16,t),stringify:n=>mn(n,16,"0x")};var Qe=class n extends R{constructor(e){super(e),this.tag=n.tag}add(e){let t;_(e)?t=e:e&&typeof e=="object"&&"key"in e&&"value"in e&&e.value===null?t=new M(e.key,null):t=new M(e,null),_e(this.items,t.key)||this.items.push(t)}get(e,t){let s=_e(this.items,e);return!t&&_(s)?N(s.key)?s.key.value:s.key:s}set(e,t){if(typeof t!="boolean")throw new Error(`Expected boolean value for set(key, value) in a YAML set, not ${typeof t}`);let s=_e(this.items,e);s&&!t?this.items.splice(this.items.indexOf(s),1):!s&&t&&this.items.push(new M(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,s){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,s);throw new Error("Set items must all have null values")}static from(e,t,s){let{replacer:i}=s,r=new this(e);if(t&&Symbol.iterator in Object(t))for(let o of t)typeof i=="function"&&(o=i.call(t,o,o)),r.items.push(Je(o,null,s));return r}};Qe.tag="tag:yaml.org,2002:set";var Et={collection:"map",identify:n=>n instanceof Set,nodeClass:Qe,default:!1,tag:"tag:yaml.org,2002:set",createNode:(n,e,t)=>Qe.from(n,e,t),resolve(n,e){if(X(n)){if(n.hasAllNullValues(!0))return Object.assign(new Qe,n);e("Set items must all have null values")}else e("Expected a mapping for this tag");return n}};function gn(n,e){let t=n[0],s=t==="-"||t==="+"?n.substring(1):n,i=o=>e?BigInt(o):Number(o),r=s.replace(/_/g,"").split(":").reduce((o,a)=>o*i(60)+i(a),i(0));return t==="-"?i(-1)*r:r}function tr(n){let{value:e}=n,t=o=>o;if(typeof e=="bigint")t=o=>BigInt(o);else if(isNaN(e)||!isFinite(e))return K(n);let s="";e<0&&(s="-",e*=t(-1));let i=t(60),r=[e%i];return e<60?r.unshift(0):(e=(e-r[0])/i,r.unshift(e%i),e>=60&&(e=(e-r[0])/i,r.unshift(e))),s+r.map(o=>String(o).padStart(2,"0")).join(":").replace(/000000\d*$/,"")}var ks={identify:n=>typeof n=="bigint"||Number.isInteger(n),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(n,e,{intAsBigInt:t})=>gn(n,t),stringify:tr},Es={identify:n=>typeof n=="number",default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:n=>gn(n,!1),stringify:tr},Xe={identify:n=>n instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(n){let e=n.match(Xe.test);if(!e)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");let[,t,s,i,r,o,a]=e.map(Number),c=e[7]?Number((e[7]+"00").substr(1,3)):0,l=Date.UTC(t,s-1,i,r||0,o||0,a||0,c),f=e[8];if(f&&f!=="Z"){let h=gn(f,!1);Math.abs(h)<30&&(h*=60),l-=6e4*h}return new Date(l)},stringify:({value:n})=>{var e;return(e=n==null?void 0:n.toISOString().replace(/(T00:00:00)?\.000Z$/,""))!=null?e:""}};var yn=[te,se,Te,Me,dn,pn,Qi,Xi,Zi,er,zi,Ji,Gi,wt,ee,St,vt,Et,ks,Es,Xe];var sr=new Map([["core",ji],["failsafe",[te,se,Te]],["json",Wi],["yaml11",yn],["yaml-1.1",yn]]),nr={binary:wt,bool:bt,float:ms,floatExp:ps,floatNaN:ds,floatTime:Es,int:bs,intHex:ws,intOct:ys,intTime:ks,map:te,merge:ee,null:Me,omap:St,pairs:vt,seq:se,set:Et,timestamp:Xe},ir={"tag:yaml.org,2002:binary":wt,"tag:yaml.org,2002:merge":ee,"tag:yaml.org,2002:omap":St,"tag:yaml.org,2002:pairs":vt,"tag:yaml.org,2002:set":Et,"tag:yaml.org,2002:timestamp":Xe};function Ns(n,e,t){let s=sr.get(e);if(s&&!n)return t&&!s.includes(ee)?s.concat(ee):s.slice();let i=s;if(!i)if(Array.isArray(n))i=[];else{let r=Array.from(sr.keys()).filter(o=>o!=="yaml11").map(o=>JSON.stringify(o)).join(", ");throw new Error(`Unknown schema "${e}"; use one of ${r} or define customTags array`)}if(Array.isArray(n))for(let r of n)i=i.concat(r);else typeof n=="function"&&(i=n(i.slice()));return t&&(i=i.concat(ee)),i.reduce((r,o)=>{let a=typeof o=="string"?nr[o]:o;if(!a){let c=JSON.stringify(o),l=Object.keys(nr).map(f=>JSON.stringify(f)).join(", ");throw new Error(`Unknown custom tag ${c}; use one of ${l}`)}return r.includes(a)||r.push(a),r},[])}var Oo=(n,e)=>n.key<e.key?-1:n.key>e.key?1:0,Nt=class n{constructor({compat:e,customTags:t,merge:s,resolveKnownTags:i,schema:r,sortMapEntries:o,toStringDefaults:a}){this.compat=Array.isArray(e)?Ns(e,"compat"):e?Ns(null,e):null,this.name=typeof r=="string"&&r||"core",this.knownTags=i?ir:{},this.tags=Ns(t,this.name,s),this.toStringOptions=a!=null?a:null,Object.defineProperty(this,Q,{value:te}),Object.defineProperty(this,W,{value:Te}),Object.defineProperty(this,ye,{value:se}),this.sortMapEntries=typeof o=="function"?o:o===!0?Oo:null}clone(){let e=Object.create(n.prototype,Object.getOwnPropertyDescriptors(this));return e.tags=this.tags.slice(),e}};function rr(n,e){var c;let t=[],s=e.directives===!0;if(e.directives!==!1&&n.directives){let l=n.directives.toString(n);l?(t.push(l),s=!0):n.directives.docStart&&(s=!0)}s&&t.push("---");let i=os(n,e),{commentString:r}=i.options;if(n.commentBefore){t.length!==1&&t.unshift("");let l=r(n.commentBefore);t.unshift(z(l,""))}let o=!1,a=null;if(n.contents){if(T(n.contents)){if(n.contents.spaceBefore&&s&&t.push(""),n.contents.commentBefore){let h=r(n.contents.commentBefore);t.push(z(h,""))}i.forceBlockIndent=!!n.comment,a=n.contents.comment}let l=a?void 0:()=>o=!0,f=ve(n.contents,i,()=>a=null,l);a&&(f+=fe(f,"",r(a))),(f[0]==="|"||f[0]===">")&&t[t.length-1]==="---"?t[t.length-1]=`--- ${f}`:t.push(f)}else t.push(ve(n.contents,i));if((c=n.directives)!=null&&c.docEnd)if(n.comment){let l=r(n.comment);l.includes(`
`)?(t.push("..."),t.push(z(l,""))):t.push(`... ${l}`)}else t.push("...");else{let l=n.comment;l&&o&&(l=l.replace(/^\n+/,"")),l&&((!o||a)&&t[t.length-1]!==""&&t.push(""),t.push(z(r(l),"")))}return t.join(`
`)+`
`}var xe=class n{constructor(e,t,s){this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,V,{value:Gt});let i=null;typeof t=="function"||Array.isArray(t)?i=t:s===void 0&&t&&(s=t,t=void 0);let r=Object.assign({intAsBigInt:!1,keepSourceTokens:!1,logLevel:"warn",prettyErrors:!0,strict:!0,stringKeys:!1,uniqueKeys:!0,version:"1.2"},s);this.options=r;let{version:o}=r;s!=null&&s._directives?(this.directives=s._directives.atDocument(),this.directives.yaml.explicit&&(o=this.directives.yaml.version)):this.directives=new le({version:o}),this.setSchema(o,s),this.contents=e===void 0?null:this.createNode(e,i,s)}clone(){let e=Object.create(n.prototype,{[V]:{value:Gt}});return e.commentBefore=this.commentBefore,e.comment=this.comment,e.errors=this.errors.slice(),e.warnings=this.warnings.slice(),e.options=Object.assign({},this.options),this.directives&&(e.directives=this.directives.clone()),e.schema=this.schema.clone(),e.contents=T(this.contents)?this.contents.clone(e.schema):this.contents,this.range&&(e.range=this.range.slice()),e}add(e){Ze(this.contents)&&this.contents.add(e)}addIn(e,t){Ze(this.contents)&&this.contents.addIn(e,t)}createAlias(e,t){if(!e.anchor){let s=sn(this);e.anchor=!t||s.has(t)?nn(t||"a",s):t}return new be(e.anchor)}createNode(e,t,s){let i;if(typeof t=="function")e=t.call({"":e},"",e),i=t;else if(Array.isArray(t)){let m=b=>typeof b=="number"||b instanceof String||b instanceof Number,y=t.filter(m).map(String);y.length>0&&(t=t.concat(y)),i=t}else s===void 0&&t&&(s=t,t=void 0);let{aliasDuplicateObjects:r,anchorPrefix:o,flow:a,keepUndefined:c,onTagObj:l,tag:f}=s!=null?s:{},{onAnchor:h,setAnchors:d,sourceObjects:p}=$i(this,o||"a"),g={aliasDuplicateObjects:r!=null?r:!0,keepUndefined:c!=null?c:!1,onAnchor:h,onTagObj:l,replacer:i,schema:this.schema,sourceObjects:p},u=we(e,f,g);return a&&x(u)&&(u.flow=!0),d(),u}createPair(e,t,s={}){let i=this.createNode(e,null,s),r=this.createNode(t,null,s);return new M(i,r)}delete(e){return Ze(this.contents)?this.contents.delete(e):!1}deleteIn(e){return He(e)?this.contents==null?!1:(this.contents=null,!0):Ze(this.contents)?this.contents.deleteIn(e):!1}get(e,t){return x(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return He(e)?!t&&N(this.contents)?this.contents.value:this.contents:x(this.contents)?this.contents.getIn(e,t):void 0}has(e){return x(this.contents)?this.contents.has(e):!1}hasIn(e){return He(e)?this.contents!==void 0:x(this.contents)?this.contents.hasIn(e):!1}set(e,t){this.contents==null?this.contents=pt(this.schema,[e],t):Ze(this.contents)&&this.contents.set(e,t)}setIn(e,t){He(e)?this.contents=t:this.contents==null?this.contents=pt(this.schema,Array.from(e),t):Ze(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t={}){typeof e=="number"&&(e=String(e));let s;switch(e){case"1.1":this.directives?this.directives.yaml.version="1.1":this.directives=new le({version:"1.1"}),s={resolveKnownTags:!1,schema:"yaml-1.1"};break;case"1.2":case"next":this.directives?this.directives.yaml.version=e:this.directives=new le({version:e}),s={resolveKnownTags:!0,schema:"core"};break;case null:this.directives&&delete this.directives,s=null;break;default:{let i=JSON.stringify(e);throw new Error(`Expected '1.1', '1.2' or null as first argument, but found: ${i}`)}}if(t.schema instanceof Object)this.schema=t.schema;else if(s)this.schema=new Nt(Object.assign(s,t));else throw new Error("With a null YAML version, the { schema: Schema } option is required")}toJS({json:e,jsonArg:t,mapAsMap:s,maxAliasCount:i,onAnchor:r,reviver:o}={}){let a={anchors:new Map,doc:this,keep:!e,mapAsMap:s===!0,mapKeyWarned:!1,maxAliasCount:typeof i=="number"?i:100},c=$(this.contents,t!=null?t:"",a);if(typeof r=="function")for(let{count:l,res:f}of a.anchors.values())r(f,l);return typeof o=="function"?Ce(o,{"":c},"",c):c}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){let t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}return rr(this,e)}};function Ze(n){if(x(n))return!0;throw new Error("Expected a YAML collection as document contents")}var Ct=class extends Error{constructor(e,t,s,i){super(),this.name=e,this.code=s,this.message=i,this.pos=t}},ne=class extends Ct{constructor(e,t,s){super("YAMLParseError",e,t,s)}},At=class extends Ct{constructor(e,t,s){super("YAMLWarning",e,t,s)}},bn=(n,e)=>t=>{if(t.pos[0]===-1)return;t.linePos=t.pos.map(a=>e.linePos(a));let{line:s,col:i}=t.linePos[0];t.message+=` at line ${s}, column ${i}`;let r=i-1,o=n.substring(e.lineStarts[s-1],e.lineStarts[s]).replace(/[\n\r]+$/,"");if(r>=60&&o.length>80){let a=Math.min(r-39,o.length-79);o="\u2026"+o.substring(a),r-=a-1}if(o.length>80&&(o=o.substring(0,79)+"\u2026"),s>1&&/^ *$/.test(o.substring(0,r))){let a=n.substring(e.lineStarts[s-2],e.lineStarts[s-1]);a.length>80&&(a=a.substring(0,79)+`\u2026
`),o=a+o}if(/[^ ]/.test(o)){let a=1,c=t.linePos[1];c&&c.line===s&&c.col>i&&(a=Math.max(1,Math.min(c.col-i,80-r)));let l=" ".repeat(r)+"^".repeat(a);t.message+=`:

${o}
${l}
`}};function ue(n,{flow:e,indicator:t,next:s,offset:i,onError:r,parentIndent:o,startOnNewline:a}){let c=!1,l=a,f=a,h="",d="",p=!1,g=!1,u=null,m=null,y=null,b=null,E=null,k=null,S=null;for(let w of n)switch(g&&(w.type!=="space"&&w.type!=="newline"&&w.type!=="comma"&&r(w.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),g=!1),u&&(l&&w.type!=="comment"&&w.type!=="newline"&&r(u,"TAB_AS_INDENT","Tabs are not allowed as indentation"),u=null),w.type){case"space":!e&&(t!=="doc-start"||(s==null?void 0:s.type)!=="flow-collection")&&w.source.includes("	")&&(u=w),f=!0;break;case"comment":{f||r(w,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");let O=w.source.substring(1)||" ";h?h+=d+O:h=O,d="",l=!1;break}case"newline":l?h?h+=w.source:(!k||t!=="seq-item-ind")&&(c=!0):d+=w.source,l=!0,p=!0,(m||y)&&(b=w),f=!0;break;case"anchor":m&&r(w,"MULTIPLE_ANCHORS","A node can have at most one anchor"),w.source.endsWith(":")&&r(w.offset+w.source.length-1,"BAD_ALIAS","Anchor ending in : is ambiguous",!0),m=w,S!=null||(S=w.offset),l=!1,f=!1,g=!0;break;case"tag":{y&&r(w,"MULTIPLE_TAGS","A node can have at most one tag"),y=w,S!=null||(S=w.offset),l=!1,f=!1,g=!0;break}case t:(m||y)&&r(w,"BAD_PROP_ORDER",`Anchors and tags must be after the ${w.source} indicator`),k&&r(w,"UNEXPECTED_TOKEN",`Unexpected ${w.source} in ${e!=null?e:"collection"}`),k=w,l=t==="seq-item-ind"||t==="explicit-key-ind",f=!1;break;case"comma":if(e){E&&r(w,"UNEXPECTED_TOKEN",`Unexpected , in ${e}`),E=w,l=!1,f=!1;break}default:r(w,"UNEXPECTED_TOKEN",`Unexpected ${w.type} token`),l=!1,f=!1}let C=n[n.length-1],P=C?C.offset+C.source.length:i;return g&&s&&s.type!=="space"&&s.type!=="newline"&&s.type!=="comma"&&(s.type!=="scalar"||s.source!=="")&&r(s.offset,"MISSING_CHAR","Tags and anchors must be separated from the next token by white space"),u&&(l&&u.indent<=o||(s==null?void 0:s.type)==="block-map"||(s==null?void 0:s.type)==="block-seq")&&r(u,"TAB_AS_INDENT","Tabs are not allowed as indentation"),{comma:E,found:k,spaceBefore:c,comment:h,hasNewline:p,anchor:m,tag:y,newlineAfterProp:b,end:P,start:S!=null?S:P}}function Oe(n){if(!n)return null;switch(n.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":if(n.source.includes(`
`))return!0;if(n.end){for(let e of n.end)if(e.type==="newline")return!0}return!1;case"flow-collection":for(let e of n.items){for(let t of e.start)if(t.type==="newline")return!0;if(e.sep){for(let t of e.sep)if(t.type==="newline")return!0}if(Oe(e.key)||Oe(e.value))return!0}return!1;default:return!0}}function _t(n,e,t){if((e==null?void 0:e.type)==="flow-collection"){let s=e.end[0];s.indent===n&&(s.source==="]"||s.source==="}")&&Oe(e)&&t(s,"BAD_INDENT","Flow end indicator should be more indented than parent",!0)}}function Cs(n,e,t){let{uniqueKeys:s}=n.options;if(s===!1)return!1;let i=typeof s=="function"?s:(r,o)=>r===o||N(r)&&N(o)&&r.value===o.value;return e.some(r=>i(r.key,t))}var or="All mapping items must start at the same column";function ar({composeNode:n,composeEmptyNode:e},t,s,i,r){var f,h;let o=(f=r==null?void 0:r.nodeClass)!=null?f:R,a=new o(t.schema);t.atRoot&&(t.atRoot=!1);let c=s.offset,l=null;for(let d of s.items){let{start:p,key:g,sep:u,value:m}=d,y=ue(p,{indicator:"explicit-key-ind",next:g!=null?g:u==null?void 0:u[0],offset:c,onError:i,parentIndent:s.indent,startOnNewline:!0}),b=!y.found;if(b){if(g&&(g.type==="block-seq"?i(c,"BLOCK_AS_IMPLICIT_KEY","A block sequence may not be used as an implicit map key"):"indent"in g&&g.indent!==s.indent&&i(c,"BAD_INDENT",or)),!y.anchor&&!y.tag&&!u){l=y.end,y.comment&&(a.comment?a.comment+=`
`+y.comment:a.comment=y.comment);continue}(y.newlineAfterProp||Oe(g))&&i(g!=null?g:p[p.length-1],"MULTILINE_IMPLICIT_KEY","Implicit keys need to be on a single line")}else((h=y.found)==null?void 0:h.indent)!==s.indent&&i(c,"BAD_INDENT",or);t.atKey=!0;let E=y.end,k=g?n(t,g,y,i):e(t,E,p,null,y,i);t.schema.compat&&_t(s.indent,g,i),t.atKey=!1,Cs(t,a.items,k)&&i(E,"DUPLICATE_KEY","Map keys must be unique");let S=ue(u!=null?u:[],{indicator:"map-value-ind",next:m,offset:k.range[2],onError:i,parentIndent:s.indent,startOnNewline:!g||g.type==="block-scalar"});if(c=S.end,S.found){b&&((m==null?void 0:m.type)==="block-map"&&!S.hasNewline&&i(c,"BLOCK_AS_IMPLICIT_KEY","Nested mappings are not allowed in compact mappings"),t.options.strict&&y.start<S.found.offset-1024&&i(k.range,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));let C=m?n(t,m,S,i):e(t,c,u,null,S,i);t.schema.compat&&_t(s.indent,m,i),c=C.range[2];let P=new M(k,C);t.options.keepSourceTokens&&(P.srcToken=d),a.items.push(P)}else{b&&i(k.range,"MISSING_CHAR","Implicit map keys need to be followed by map values"),S.comment&&(k.comment?k.comment+=`
`+S.comment:k.comment=S.comment);let C=new M(k);t.options.keepSourceTokens&&(C.srcToken=d),a.items.push(C)}}return l&&l<c&&i(l,"IMPOSSIBLE","Map comment with trailing content"),a.range=[s.offset,c,l!=null?l:c],a}function cr({composeNode:n,composeEmptyNode:e},t,s,i,r){var f;let o=(f=r==null?void 0:r.nodeClass)!=null?f:F,a=new o(t.schema);t.atRoot&&(t.atRoot=!1),t.atKey&&(t.atKey=!1);let c=s.offset,l=null;for(let{start:h,value:d}of s.items){let p=ue(h,{indicator:"seq-item-ind",next:d,offset:c,onError:i,parentIndent:s.indent,startOnNewline:!0});if(!p.found)if(p.anchor||p.tag||d)d&&d.type==="block-seq"?i(p.end,"BAD_INDENT","All sequence items must start at the same column"):i(c,"MISSING_CHAR","Sequence item without - indicator");else{l=p.end,p.comment&&(a.comment=p.comment);continue}let g=d?n(t,d,p,i):e(t,p.end,h,null,p,i);t.schema.compat&&_t(s.indent,d,i),c=g.range[2],a.items.push(g)}return a.range=[s.offset,c,l!=null?l:c],a}function he(n,e,t,s){let i="";if(n){let r=!1,o="";for(let a of n){let{source:c,type:l}=a;switch(l){case"space":r=!0;break;case"comment":{t&&!r&&s(a,"MISSING_CHAR","Comments must be separated from other tokens by white space characters");let f=c.substring(1)||" ";i?i+=o+f:i=f,o="";break}case"newline":i&&(o+=c),r=!0;break;default:s(a,"UNEXPECTED_TOKEN",`Unexpected ${l} at node end`)}e+=c.length}}return{comment:i,offset:e}}var wn="Block collections are not allowed within flow collections",vn=n=>n&&(n.type==="block-map"||n.type==="block-seq");function lr({composeNode:n,composeEmptyNode:e},t,s,i,r){var m,y;let o=s.start.source==="{",a=o?"flow map":"flow sequence",c=(m=r==null?void 0:r.nodeClass)!=null?m:o?R:F,l=new c(t.schema);l.flow=!0;let f=t.atRoot;f&&(t.atRoot=!1),t.atKey&&(t.atKey=!1);let h=s.offset+s.start.source.length;for(let b=0;b<s.items.length;++b){let E=s.items[b],{start:k,key:S,sep:C,value:P}=E,w=ue(k,{flow:a,indicator:"explicit-key-ind",next:S!=null?S:C==null?void 0:C[0],offset:h,onError:i,parentIndent:s.indent,startOnNewline:!1});if(!w.found){if(!w.anchor&&!w.tag&&!C&&!P){b===0&&w.comma?i(w.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${a}`):b<s.items.length-1&&i(w.start,"UNEXPECTED_TOKEN",`Unexpected empty item in ${a}`),w.comment&&(l.comment?l.comment+=`
`+w.comment:l.comment=w.comment),h=w.end;continue}!o&&t.options.strict&&Oe(S)&&i(S,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line")}if(b===0)w.comma&&i(w.comma,"UNEXPECTED_TOKEN",`Unexpected , in ${a}`);else if(w.comma||i(w.start,"MISSING_CHAR",`Missing , between ${a} items`),w.comment){let O="";e:for(let I of k)switch(I.type){case"comma":case"space":break;case"comment":O=I.source.substring(1);break e;default:break e}if(O){let I=l.items[l.items.length-1];_(I)&&(I=(y=I.value)!=null?y:I.key),I.comment?I.comment+=`
`+O:I.comment=O,w.comment=w.comment.substring(O.length+1)}}if(!o&&!C&&!w.found){let O=P?n(t,P,w,i):e(t,w.end,C,null,w,i);l.items.push(O),h=O.range[2],vn(P)&&i(O.range,"BLOCK_IN_FLOW",wn)}else{t.atKey=!0;let O=w.end,I=S?n(t,S,w,i):e(t,O,k,null,w,i);vn(S)&&i(I.range,"BLOCK_IN_FLOW",wn),t.atKey=!1;let q=ue(C!=null?C:[],{flow:a,indicator:"map-value-ind",next:P,offset:I.range[2],onError:i,parentIndent:s.indent,startOnNewline:!1});if(q.found){if(!o&&!w.found&&t.options.strict){if(C)for(let D of C){if(D===q.found)break;if(D.type==="newline"){i(D,"MULTILINE_IMPLICIT_KEY","Implicit keys of flow sequence pairs need to be on a single line");break}}w.start<q.found.offset-1024&&i(q.found,"KEY_OVER_1024_CHARS","The : indicator must be at most 1024 chars after the start of an implicit flow sequence key")}}else P&&("source"in P&&P.source&&P.source[0]===":"?i(P,"MISSING_CHAR",`Missing space after : in ${a}`):i(q.start,"MISSING_CHAR",`Missing , or : between ${a} items`));let re=P?n(t,P,q,i):q.found?e(t,q.end,C,null,q,i):null;re?vn(P)&&i(re.range,"BLOCK_IN_FLOW",wn):q.comment&&(I.comment?I.comment+=`
`+q.comment:I.comment=q.comment);let $e=new M(I,re);if(t.options.keepSourceTokens&&($e.srcToken=E),o){let D=l;Cs(t,D.items,I)&&i(O,"DUPLICATE_KEY","Map keys must be unique"),D.items.push($e)}else{let D=new R(t.schema);D.flow=!0,D.items.push($e);let Mn=(re!=null?re:I).range;D.range=[I.range[0],Mn[1],Mn[2]],l.items.push(D)}h=re?re.range[2]:q.end}}let d=o?"}":"]",[p,...g]=s.end,u=h;if(p&&p.source===d)u=p.offset+p.source.length;else{let b=a[0].toUpperCase()+a.substring(1),E=f?`${b} must end with a ${d}`:`${b} in block collection must be sufficiently indented and end with a ${d}`;i(h,f?"MISSING_CHAR":"BAD_INDENT",E),p&&p.source.length!==1&&g.unshift(p)}if(g.length>0){let b=he(g,u,t.options.strict,i);b.comment&&(l.comment?l.comment+=`
`+b.comment:l.comment=b.comment),l.range=[s.offset,u,b.offset]}else l.range=[s.offset,u,u];return l}function Sn(n,e,t,s,i,r){let o=t.type==="block-map"?ar(n,e,t,s,r):t.type==="block-seq"?cr(n,e,t,s,r):lr(n,e,t,s,r),a=o.constructor;return i==="!"||i===a.tagName?(o.tag=a.tagName,o):(i&&(o.tag=i),o)}function fr(n,e,t,s,i){var d,p,g;let r=s.tag,o=r?e.directives.tagName(r.source,u=>i(r,"TAG_RESOLVE_FAILED",u)):null;if(t.type==="block-seq"){let{anchor:u,newlineAfterProp:m}=s,y=u&&r?u.offset>r.offset?u:r:u!=null?u:r;y&&(!m||m.offset<y.offset)&&i(y,"MISSING_CHAR","Missing newline after block sequence props")}let a=t.type==="block-map"?"map":t.type==="block-seq"?"seq":t.start.source==="{"?"map":"seq";if(!r||!o||o==="!"||o===R.tagName&&a==="map"||o===F.tagName&&a==="seq")return Sn(n,e,t,i,o);let c=e.schema.tags.find(u=>u.tag===o&&u.collection===a);if(!c){let u=e.schema.knownTags[o];if(u&&u.collection===a)e.schema.tags.push(Object.assign({},u,{default:!1})),c=u;else return u?i(r,"BAD_COLLECTION_TYPE",`${u.tag} used for ${a} collection, but expects ${(d=u.collection)!=null?d:"scalar"}`,!0):i(r,"TAG_RESOLVE_FAILED",`Unresolved tag: ${o}`,!0),Sn(n,e,t,i,o)}let l=Sn(n,e,t,i,o,c),f=(g=(p=c.resolve)==null?void 0:p.call(c,l,u=>i(r,"TAG_RESOLVE_FAILED",u),e.options))!=null?g:l,h=T(f)?f:new v(f);return h.range=l.range,h.tag=o,c!=null&&c.format&&(h.format=c.format),h}function kn(n,e,t){let s=e.offset,i=Po(e,n.options.strict,t);if(!i)return{value:"",type:null,comment:"",range:[s,s,s]};let r=i.mode===">"?v.BLOCK_FOLDED:v.BLOCK_LITERAL,o=e.source?Io(e.source):[],a=o.length;for(let u=o.length-1;u>=0;--u){let m=o[u][1];if(m===""||m==="\r")a=u;else break}if(a===0){let u=i.chomp==="+"&&o.length>0?`
`.repeat(Math.max(1,o.length-1)):"",m=s+i.length;return e.source&&(m+=e.source.length),{value:u,type:r,comment:i.comment,range:[s,m,m]}}let c=e.indent+i.indent,l=e.offset+i.length,f=0;for(let u=0;u<a;++u){let[m,y]=o[u];if(y===""||y==="\r")i.indent===0&&m.length>c&&(c=m.length);else{m.length<c&&t(l+m.length,"MISSING_CHAR","Block scalars with more-indented leading empty lines must use an explicit indentation indicator"),i.indent===0&&(c=m.length),f=u,c===0&&!n.atRoot&&t(l,"BAD_INDENT","Block scalar values in collections must be indented");break}l+=m.length+y.length+1}for(let u=o.length-1;u>=a;--u)o[u][0].length>c&&(a=u+1);let h="",d="",p=!1;for(let u=0;u<f;++u)h+=o[u][0].slice(c)+`
`;for(let u=f;u<a;++u){let[m,y]=o[u];l+=m.length+y.length+1;let b=y[y.length-1]==="\r";if(b&&(y=y.slice(0,-1)),y&&m.length<c){let k=`Block scalar lines must not be less indented than their ${i.indent?"explicit indentation indicator":"first line"}`;t(l-y.length-(b?2:1),"BAD_INDENT",k),m=""}r===v.BLOCK_LITERAL?(h+=d+m.slice(c)+y,d=`
`):m.length>c||y[0]==="	"?(d===" "?d=`
`:!p&&d===`
`&&(d=`

`),h+=d+m.slice(c)+y,d=`
`,p=!0):y===""?d===`
`?h+=`
`:d=`
`:(h+=d+y,d=" ",p=!1)}switch(i.chomp){case"-":break;case"+":for(let u=a;u<o.length;++u)h+=`
`+o[u][0].slice(c);h[h.length-1]!==`
`&&(h+=`
`);break;default:h+=`
`}let g=s+i.length+e.source.length;return{value:h,type:r,comment:i.comment,range:[s,g,g]}}function Po({offset:n,props:e},t,s){if(e[0].type!=="block-scalar-header")return s(e[0],"IMPOSSIBLE","Block scalar header not found"),null;let{source:i}=e[0],r=i[0],o=0,a="",c=-1;for(let d=1;d<i.length;++d){let p=i[d];if(!a&&(p==="-"||p==="+"))a=p;else{let g=Number(p);!o&&g?o=g:c===-1&&(c=n+d)}}c!==-1&&s(c,"UNEXPECTED_TOKEN",`Block scalar header includes extra characters: ${i}`);let l=!1,f="",h=i.length;for(let d=1;d<e.length;++d){let p=e[d];switch(p.type){case"space":l=!0;case"newline":h+=p.source.length;break;case"comment":t&&!l&&s(p,"MISSING_CHAR","Comments must be separated from other tokens by white space characters"),h+=p.source.length,f=p.source.substring(1);break;case"error":s(p,"UNEXPECTED_TOKEN",p.message),h+=p.source.length;break;default:{let g=`Unexpected token in block scalar header: ${p.type}`;s(p,"UNEXPECTED_TOKEN",g);let u=p.source;u&&typeof u=="string"&&(h+=u.length)}}}return{mode:r,indent:o,chomp:a,comment:f,length:h}}function Io(n){let e=n.split(/\n( *)/),t=e[0],s=t.match(/^( *)/),r=[s!=null&&s[1]?[s[1],t.slice(s[1].length)]:["",t]];for(let o=1;o<e.length;o+=2)r.push([e[o],e[o+1]]);return r}function En(n,e,t){let{offset:s,type:i,source:r,end:o}=n,a,c,l=(d,p,g)=>t(s+d,p,g);switch(i){case"scalar":a=v.PLAIN,c=Lo(r,l);break;case"single-quoted-scalar":a=v.QUOTE_SINGLE,c=Bo(r,l);break;case"double-quoted-scalar":a=v.QUOTE_DOUBLE,c=Mo(r,l);break;default:return t(n,"UNEXPECTED_TOKEN",`Expected a flow scalar value, but found: ${i}`),{value:"",type:null,comment:"",range:[s,s+r.length,s+r.length]}}let f=s+r.length,h=he(o,f,e,t);return{value:c,type:a,comment:h.comment,range:[s,f,h.offset]}}function Lo(n,e){let t="";switch(n[0]){case"	":t="a tab character";break;case",":t="flow indicator character ,";break;case"%":t="directive indicator character %";break;case"|":case">":{t=`block scalar indicator ${n[0]}`;break}case"@":case"`":{t=`reserved character ${n[0]}`;break}}return t&&e(0,"BAD_SCALAR_START",`Plain value cannot start with ${t}`),ur(n)}function Bo(n,e){return(n[n.length-1]!=="'"||n.length===1)&&e(n.length,"MISSING_CHAR","Missing closing 'quote"),ur(n.slice(1,-1)).replace(/''/g,"'")}function ur(n){var c;let e,t;try{e=new RegExp(`(.*?)(?<![ 	])[ 	]*\r?
`,"sy"),t=new RegExp(`[ 	]*(.*?)(?:(?<![ 	])[ 	]*)?\r?
`,"sy")}catch(l){e=/(.*?)[ \t]*\r?\n/sy,t=/[ \t]*(.*?)[ \t]*\r?\n/sy}let s=e.exec(n);if(!s)return n;let i=s[1],r=" ",o=e.lastIndex;for(t.lastIndex=o;s=t.exec(n);)s[1]===""?r===`
`?i+=r:r=`
`:(i+=r+s[1],r=" "),o=t.lastIndex;let a=/[ \t]*(.*)/sy;return a.lastIndex=o,s=a.exec(n),i+r+((c=s==null?void 0:s[1])!=null?c:"")}function Mo(n,e){let t="";for(let s=1;s<n.length-1;++s){let i=n[s];if(!(i==="\r"&&n[s+1]===`
`))if(i===`
`){let{fold:r,offset:o}=Ro(n,s);t+=r,s=o}else if(i==="\\"){let r=n[++s],o=Do[r];if(o)t+=o;else if(r===`
`)for(r=n[s+1];r===" "||r==="	";)r=n[++s+1];else if(r==="\r"&&n[s+1]===`
`)for(r=n[++s+1];r===" "||r==="	";)r=n[++s+1];else if(r==="x"||r==="u"||r==="U"){let a={x:2,u:4,U:8}[r];t+=$o(n,s+1,a,e),s+=a}else{let a=n.substr(s-1,2);e(s-1,"BAD_DQ_ESCAPE",`Invalid escape sequence ${a}`),t+=a}}else if(i===" "||i==="	"){let r=s,o=n[s+1];for(;o===" "||o==="	";)o=n[++s+1];o!==`
`&&!(o==="\r"&&n[s+2]===`
`)&&(t+=s>r?n.slice(r,s+1):i)}else t+=i}return(n[n.length-1]!=='"'||n.length===1)&&e(n.length,"MISSING_CHAR",'Missing closing "quote'),t}function Ro(n,e){let t="",s=n[e+1];for(;(s===" "||s==="	"||s===`
`||s==="\r")&&!(s==="\r"&&n[e+2]!==`
`);)s===`
`&&(t+=`
`),e+=1,s=n[e+1];return t||(t=" "),{fold:t,offset:e}}var Do={0:"\0",a:"\x07",b:"\b",e:"\x1B",f:"\f",n:`
`,r:"\r",t:"	",v:"\v",N:"\x85",_:"\xA0",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","	":"	"};function $o(n,e,t,s){let i=n.substr(e,t),o=i.length===t&&/^[0-9a-fA-F]+$/.test(i)?parseInt(i,16):NaN;if(isNaN(o)){let a=n.substr(e-2,t+2);return s(e-2,"BAD_DQ_ESCAPE",`Invalid escape sequence ${a}`),a}return String.fromCodePoint(o)}function Nn(n,e,t,s){let{value:i,type:r,comment:o,range:a}=e.type==="block-scalar"?kn(n,e,s):En(e,n.options.strict,s),c=t?n.directives.tagName(t.source,h=>s(t,"TAG_RESOLVE_FAILED",h)):null,l;n.options.stringKeys&&n.atKey?l=n.schema[W]:c?l=qo(n.schema,i,c,t,s):e.type==="scalar"?l=Fo(n,i,e,s):l=n.schema[W];let f;try{let h=l.resolve(i,d=>s(t!=null?t:e,"TAG_RESOLVE_FAILED",d),n.options);f=N(h)?h:new v(h)}catch(h){let d=h instanceof Error?h.message:String(h);s(t!=null?t:e,"TAG_RESOLVE_FAILED",d),f=new v(i)}return f.range=a,f.source=i,r&&(f.type=r),c&&(f.tag=c),l.format&&(f.format=l.format),o&&(f.comment=o),f}function qo(n,e,t,s,i){var a;if(t==="!")return n[W];let r=[];for(let c of n.tags)if(!c.collection&&c.tag===t)if(c.default&&c.test)r.push(c);else return c;for(let c of r)if((a=c.test)!=null&&a.test(e))return c;let o=n.knownTags[t];return o&&!o.collection?(n.tags.push(Object.assign({},o,{default:!1,test:void 0})),o):(i(s,"TAG_RESOLVE_FAILED",`Unresolved tag: ${t}`,t!=="tag:yaml.org,2002:str"),n[W])}function Fo({atKey:n,directives:e,schema:t},s,i,r){var a;let o=t.tags.find(c=>{var l;return(c.default===!0||n&&c.default==="key")&&((l=c.test)==null?void 0:l.test(s))})||t[W];if(t.compat){let c=(a=t.compat.find(l=>{var f;return l.default&&((f=l.test)==null?void 0:f.test(s))}))!=null?a:t[W];if(o.tag!==c.tag){let l=e.tagString(o.tag),f=e.tagString(c.tag),h=`Value may be parsed as either ${l} or ${f}`;r(i,"TAG_RESOLVE_FAILED",h,!0)}}return o}function hr(n,e,t){if(e){t!=null||(t=e.length);for(let s=t-1;s>=0;--s){let i=e[s];switch(i.type){case"space":case"comment":case"newline":n-=i.source.length;continue}for(i=e[++s];(i==null?void 0:i.type)==="space";)n+=i.source.length,i=e[++s];break}}return n}var Ko={composeNode:Cn,composeEmptyNode:As};function Cn(n,e,t,s){let i=n.atKey,{spaceBefore:r,comment:o,anchor:a,tag:c}=t,l,f=!0;switch(e.type){case"alias":l=Uo(n,e,s),(a||c)&&s(e,"ALIAS_PROPS","An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":l=Nn(n,e,c,s),a&&(l.anchor=a.source.substring(1));break;case"block-map":case"block-seq":case"flow-collection":l=fr(Ko,n,e,t,s),a&&(l.anchor=a.source.substring(1));break;default:{let h=e.type==="error"?e.message:`Unsupported token (type: ${e.type})`;s(e,"UNEXPECTED_TOKEN",h),l=As(n,e.offset,void 0,null,t,s),f=!1}}return a&&l.anchor===""&&s(a,"BAD_ALIAS","Anchor cannot be an empty string"),i&&n.options.stringKeys&&(!N(l)||typeof l.value!="string"||l.tag&&l.tag!=="tag:yaml.org,2002:str")&&s(c!=null?c:e,"NON_STRING_KEY","With stringKeys, all keys must be strings"),r&&(l.spaceBefore=!0),o&&(e.type==="scalar"&&e.source===""?l.comment=o:l.commentBefore=o),n.options.keepSourceTokens&&f&&(l.srcToken=e),l}function As(n,e,t,s,{spaceBefore:i,comment:r,anchor:o,tag:a,end:c},l){let f={type:"scalar",offset:hr(e,t,s),indent:-1,source:""},h=Nn(n,f,a,l);return o&&(h.anchor=o.source.substring(1),h.anchor===""&&l(o,"BAD_ALIAS","Anchor cannot be an empty string")),i&&(h.spaceBefore=!0),r&&(h.comment=r,h.range[2]=c),h}function Uo({options:n},{offset:e,source:t,end:s},i){let r=new be(t.substring(1));r.source===""&&i(e,"BAD_ALIAS","Alias cannot be an empty string"),r.source.endsWith(":")&&i(e+t.length-1,"BAD_ALIAS","Alias ending in : is ambiguous",!0);let o=e+t.length,a=he(s,o,n.strict,i);return r.range=[e,o,a.offset],a.comment&&(r.comment=a.comment),r}function dr(n,e,{offset:t,start:s,value:i,end:r},o){let a=Object.assign({_directives:e},n),c=new xe(void 0,a),l={atKey:!1,atRoot:!0,directives:c.directives,options:c.options,schema:c.schema},f=ue(s,{indicator:"doc-start",next:i!=null?i:r==null?void 0:r[0],offset:t,onError:o,parentIndent:0,startOnNewline:!0});f.found&&(c.directives.docStart=!0,i&&(i.type==="block-map"||i.type==="block-seq")&&!f.hasNewline&&o(f.end,"MISSING_CHAR","Block collection cannot start on same line with directives-end marker")),c.contents=i?Cn(l,i,f,o):As(l,f.end,s,null,f,o);let h=c.contents.range[2],d=he(r,h,!1,o);return d.comment&&(c.comment=d.comment),c.range=[t,h,d.offset],c}function Tt(n){if(typeof n=="number")return[n,n+1];if(Array.isArray(n))return n.length===2?n:[n[0],n[1]];let{offset:e,source:t}=n;return[e,e+(typeof t=="string"?t.length:1)]}function pr(n){var i;let e="",t=!1,s=!1;for(let r=0;r<n.length;++r){let o=n[r];switch(o[0]){case"#":e+=(e===""?"":s?`

`:`
`)+(o.substring(1)||" "),t=!0,s=!1;break;case"%":((i=n[r+1])==null?void 0:i[0])!=="#"&&(r+=1),t=!1;break;default:t||(s=!0),t=!1}}return{comment:e,afterEmptyLine:s}}var xt=class{constructor(e={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(t,s,i,r)=>{let o=Tt(t);r?this.warnings.push(new At(o,s,i)):this.errors.push(new ne(o,s,i))},this.directives=new le({version:e.version||"1.2"}),this.options=e}decorate(e,t){let{comment:s,afterEmptyLine:i}=pr(this.prelude);if(s){let r=e.contents;if(t)e.comment=e.comment?`${e.comment}
${s}`:s;else if(i||e.directives.docStart||!r)e.commentBefore=s;else if(x(r)&&!r.flow&&r.items.length>0){let o=r.items[0];_(o)&&(o=o.key);let a=o.commentBefore;o.commentBefore=a?`${s}
${a}`:s}else{let o=r.commentBefore;r.commentBefore=o?`${s}
${o}`:s}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:pr(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}*compose(e,t=!1,s=-1){for(let i of e)yield*this.next(i);yield*this.end(t,s)}*next(e){switch(e.type){case"directive":this.directives.add(e.source,(t,s,i)=>{let r=Tt(e);r[0]+=t,this.onError(r,"BAD_DIRECTIVE",s,i)}),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{let t=dr(this.options,this.directives,e,this.onError);this.atDirectives&&!t.directives.docStart&&this.onError(e,"MISSING_CHAR","Missing directives-end/doc-start indicator line"),this.decorate(t,!1),this.doc&&(yield this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{let t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,s=new ne(Tt(e),"UNEXPECTED_TOKEN",t);this.atDirectives||!this.doc?this.errors.push(s):this.doc.errors.push(s);break}case"doc-end":{if(!this.doc){let s="Unexpected doc-end without preceding document";this.errors.push(new ne(Tt(e),"UNEXPECTED_TOKEN",s));break}this.doc.directives.docEnd=!0;let t=he(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){let s=this.doc.comment;this.doc.comment=s?`${s}
${t.comment}`:t.comment}this.doc.range[2]=t.offset;break}default:this.errors.push(new ne(Tt(e),"UNEXPECTED_TOKEN",`Unsupported token ${e.type}`))}}*end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),yield this.doc,this.doc=null;else if(e){let s=Object.assign({_directives:this.directives},this.options),i=new xe(void 0,s);this.atDirectives&&this.onError(t,"MISSING_CHAR","Missing directives-end indicator line"),i.range=[0,t,t],this.decorate(i,!1),yield i}}};var An=Symbol("break visit"),Vo=Symbol("skip children"),mr=Symbol("remove item");function Re(n,e){"type"in n&&n.type==="document"&&(n={start:n.start,value:n.value}),gr(Object.freeze([]),n,e)}Re.BREAK=An;Re.SKIP=Vo;Re.REMOVE=mr;Re.itemAtPath=(n,e)=>{let t=n;for(let[s,i]of e){let r=t==null?void 0:t[s];if(r&&"items"in r)t=r.items[i];else return}return t};Re.parentCollection=(n,e)=>{let t=Re.itemAtPath(n,e.slice(0,-1)),s=e[e.length-1][0],i=t==null?void 0:t[s];if(i&&"items"in i)return i;throw new Error("Parent collection not found")};function gr(n,e,t){let s=t(e,n);if(typeof s=="symbol")return s;for(let i of["key","value"]){let r=e[i];if(r&&"items"in r){for(let o=0;o<r.items.length;++o){let a=gr(Object.freeze(n.concat([[i,o]])),r.items[o],t);if(typeof a=="number")o=a-1;else{if(a===An)return An;a===mr&&(r.items.splice(o,1),o-=1)}}typeof s=="function"&&i==="key"&&(s=s(e,n))}}return typeof s=="function"?s(e,n):s}var _n="\uFEFF",Tn="",xn="",_s="";function yr(n){switch(n){case _n:return"byte-order-mark";case Tn:return"doc-mode";case xn:return"flow-error-end";case _s:return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case`
`:case`\r
`:return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(n[0]){case" ":case"	":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}function ie(n){switch(n){case void 0:case" ":case`
`:case"\r":case"	":return!0;default:return!1}}var br=new Set("0123456789ABCDEFabcdef"),Yo=new Set("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-#;/?:@&=+$_.!~*'()"),Ts=new Set(",[]{}"),Wo=new Set(` ,[]{}
\r	`),On=n=>!n||Wo.has(n),Ot=class{constructor(){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.lineEndPos=null,this.next=null,this.pos=0}*lex(e,t=!1){var i;if(e){if(typeof e!="string")throw TypeError("source is not a string");this.buffer=this.buffer?this.buffer+e:e,this.lineEndPos=null}this.atEnd=!t;let s=(i=this.next)!=null?i:"stream";for(;s&&(t||this.hasChars(1));)s=yield*this.parseNext(s)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;t===" "||t==="	";)t=this.buffer[++e];return!t||t==="#"||t===`
`?!0:t==="\r"?this.buffer[e+1]===`
`:!1}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let s=0;for(;t===" ";)t=this.buffer[++s+e];if(t==="\r"){let i=this.buffer[s+e+1];if(i===`
`||!i&&!this.atEnd)return e+s+1}return t===`
`||s>=this.indentNext||!t&&!this.atEnd?e+s:-1}if(t==="-"||t==="."){let s=this.buffer.substr(e,3);if((s==="---"||s==="...")&&ie(this.buffer[e+3]))return-1}return e}getLine(){let e=this.lineEndPos;return(typeof e!="number"||e!==-1&&e<this.pos)&&(e=this.buffer.indexOf(`
`,this.pos),this.lineEndPos=e),e===-1?this.atEnd?this.buffer.substring(this.pos):null:(this.buffer[e-1]==="\r"&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.lineEndPos=null,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}*parseNext(e){switch(e){case"stream":return yield*this.parseStream();case"line-start":return yield*this.parseLineStart();case"block-start":return yield*this.parseBlockStart();case"doc":return yield*this.parseDocument();case"flow":return yield*this.parseFlowCollection();case"quoted-scalar":return yield*this.parseQuotedScalar();case"block-scalar":return yield*this.parseBlockScalar();case"plain-scalar":return yield*this.parsePlainScalar()}}*parseStream(){let e=this.getLine();if(e===null)return this.setNext("stream");if(e[0]===_n&&(yield*this.pushCount(1),e=e.substring(1)),e[0]==="%"){let t=e.length,s=e.indexOf("#");for(;s!==-1;){let r=e[s-1];if(r===" "||r==="	"){t=s-1;break}else s=e.indexOf("#",s+1)}for(;;){let r=e[t-1];if(r===" "||r==="	")t-=1;else break}let i=(yield*this.pushCount(t))+(yield*this.pushSpaces(!0));return yield*this.pushCount(e.length-i),this.pushNewline(),"stream"}if(this.atLineEnd()){let t=yield*this.pushSpaces(!0);return yield*this.pushCount(e.length-t),yield*this.pushNewline(),"stream"}return yield Tn,yield*this.parseLineStart()}*parseLineStart(){let e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if(e==="-"||e==="."){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");let t=this.peek(3);if((t==="---"||t==="...")&&ie(this.charAt(3)))return yield*this.pushCount(3),this.indentValue=0,this.indentNext=0,t==="---"?"doc":"stream"}return this.indentValue=yield*this.pushSpaces(!1),this.indentNext>this.indentValue&&!ie(this.charAt(1))&&(this.indentNext=this.indentValue),yield*this.parseBlockStart()}*parseBlockStart(){let[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if((e==="-"||e==="?"||e===":")&&ie(t)){let s=(yield*this.pushCount(1))+(yield*this.pushSpaces(!0));return this.indentNext=this.indentValue+1,this.indentValue+=s,yield*this.parseBlockStart()}return"doc"}*parseDocument(){yield*this.pushSpaces(!0);let e=this.getLine();if(e===null)return this.setNext("doc");let t=yield*this.pushIndicators();switch(e[t]){case"#":yield*this.pushCount(e.length-t);case void 0:return yield*this.pushNewline(),yield*this.parseLineStart();case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return yield*this.pushCount(1),"doc";case"*":return yield*this.pushUntil(On),"doc";case'"':case"'":return yield*this.parseQuotedScalar();case"|":case">":return t+=yield*this.parseBlockScalarHeader(),t+=yield*this.pushSpaces(!0),yield*this.pushCount(e.length-t),yield*this.pushNewline(),yield*this.parseBlockScalar();default:return yield*this.parsePlainScalar()}}*parseFlowCollection(){let e,t,s=-1;do e=yield*this.pushNewline(),e>0?(t=yield*this.pushSpaces(!1),this.indentValue=s=t):t=0,t+=yield*this.pushSpaces(!0);while(e+t>0);let i=this.getLine();if(i===null)return this.setNext("flow");if((s!==-1&&s<this.indentNext&&i[0]!=="#"||s===0&&(i.startsWith("---")||i.startsWith("..."))&&ie(i[3]))&&!(s===this.indentNext-1&&this.flowLevel===1&&(i[0]==="]"||i[0]==="}")))return this.flowLevel=0,yield xn,yield*this.parseLineStart();let r=0;for(;i[r]===",";)r+=yield*this.pushCount(1),r+=yield*this.pushSpaces(!0),this.flowKey=!1;switch(r+=yield*this.pushIndicators(),i[r]){case void 0:return"flow";case"#":return yield*this.pushCount(i.length-r),"flow";case"{":case"[":return yield*this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return yield*this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return yield*this.pushUntil(On),"flow";case'"':case"'":return this.flowKey=!0,yield*this.parseQuotedScalar();case":":{let o=this.charAt(1);if(this.flowKey||ie(o)||o===",")return this.flowKey=!1,yield*this.pushCount(1),yield*this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,yield*this.parsePlainScalar()}}*parseQuotedScalar(){let e=this.charAt(0),t=this.buffer.indexOf(e,this.pos+1);if(e==="'")for(;t!==-1&&this.buffer[t+1]==="'";)t=this.buffer.indexOf("'",t+2);else for(;t!==-1;){let r=0;for(;this.buffer[t-1-r]==="\\";)r+=1;if(r%2===0)break;t=this.buffer.indexOf('"',t+1)}let s=this.buffer.substring(0,t),i=s.indexOf(`
`,this.pos);if(i!==-1){for(;i!==-1;){let r=this.continueScalar(i+1);if(r===-1)break;i=s.indexOf(`
`,r)}i!==-1&&(t=i-(s[i-1]==="\r"?2:1))}if(t===-1){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return yield*this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}*parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){let t=this.buffer[++e];if(t==="+")this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if(t!=="-")break}return yield*this.pushUntil(t=>ie(t)||t==="#")}*parseBlockScalar(){let e=this.pos-1,t=0,s;e:for(let r=this.pos;s=this.buffer[r];++r)switch(s){case" ":t+=1;break;case`
`:e=r,t=0;break;case"\r":{let o=this.buffer[r+1];if(!o&&!this.atEnd)return this.setNext("block-scalar");if(o===`
`)break}default:break e}if(!s&&!this.atEnd)return this.setNext("block-scalar");if(t>=this.indentNext){this.blockScalarIndent===-1?this.indentNext=t:this.indentNext=this.blockScalarIndent+(this.indentNext===0?1:this.indentNext);do{let r=this.continueScalar(e+1);if(r===-1)break;e=this.buffer.indexOf(`
`,r)}while(e!==-1);if(e===-1){if(!this.atEnd)return this.setNext("block-scalar");e=this.buffer.length}}let i=e+1;for(s=this.buffer[i];s===" ";)s=this.buffer[++i];if(s==="	"){for(;s==="	"||s===" "||s==="\r"||s===`
`;)s=this.buffer[++i];e=i-1}else if(!this.blockScalarKeep)do{let r=e-1,o=this.buffer[r];o==="\r"&&(o=this.buffer[--r]);let a=r;for(;o===" ";)o=this.buffer[--r];if(o===`
`&&r>=this.pos&&r+1+t>a)e=r;else break}while(!0);return yield _s,yield*this.pushToIndex(e+1,!0),yield*this.parseLineStart()}*parsePlainScalar(){let e=this.flowLevel>0,t=this.pos-1,s=this.pos-1,i;for(;i=this.buffer[++s];)if(i===":"){let r=this.buffer[s+1];if(ie(r)||e&&Ts.has(r))break;t=s}else if(ie(i)){let r=this.buffer[s+1];if(i==="\r"&&(r===`
`?(s+=1,i=`
`,r=this.buffer[s+1]):t=s),r==="#"||e&&Ts.has(r))break;if(i===`
`){let o=this.continueScalar(s+1);if(o===-1)break;s=Math.max(s,o-2)}}else{if(e&&Ts.has(i))break;t=s}return!i&&!this.atEnd?this.setNext("plain-scalar"):(yield _s,yield*this.pushToIndex(t+1,!0),e?"flow":"doc")}*pushCount(e){return e>0?(yield this.buffer.substr(this.pos,e),this.pos+=e,e):0}*pushToIndex(e,t){let s=this.buffer.slice(this.pos,e);return s?(yield s,this.pos+=s.length,s.length):(t&&(yield""),0)}*pushIndicators(){switch(this.charAt(0)){case"!":return(yield*this.pushTag())+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"&":return(yield*this.pushUntil(On))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators());case"-":case"?":case":":{let e=this.flowLevel>0,t=this.charAt(1);if(ie(t)||e&&Ts.has(t))return e?this.flowKey&&(this.flowKey=!1):this.indentNext=this.indentValue+1,(yield*this.pushCount(1))+(yield*this.pushSpaces(!0))+(yield*this.pushIndicators())}}return 0}*pushTag(){if(this.charAt(1)==="<"){let e=this.pos+2,t=this.buffer[e];for(;!ie(t)&&t!==">";)t=this.buffer[++e];return yield*this.pushToIndex(t===">"?e+1:e,!1)}else{let e=this.pos+1,t=this.buffer[e];for(;t;)if(Yo.has(t))t=this.buffer[++e];else if(t==="%"&&br.has(this.buffer[e+1])&&br.has(this.buffer[e+2]))t=this.buffer[e+=3];else break;return yield*this.pushToIndex(e,!1)}}*pushNewline(){let e=this.buffer[this.pos];return e===`
`?yield*this.pushCount(1):e==="\r"&&this.charAt(1)===`
`?yield*this.pushCount(2):0}*pushSpaces(e){let t=this.pos-1,s;do s=this.buffer[++t];while(s===" "||e&&s==="	");let i=t-this.pos;return i>0&&(yield this.buffer.substr(this.pos,i),this.pos=t),i}*pushUntil(e){let t=this.pos,s=this.buffer[t];for(;!e(s);)s=this.buffer[++t];return yield*this.pushToIndex(t,!1)}};var Pt=class{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,s=this.lineStarts.length;for(;t<s;){let r=t+s>>1;this.lineStarts[r]<e?t=r+1:s=r}if(this.lineStarts[t]===e)return{line:t+1,col:1};if(t===0)return{line:0,col:e};let i=this.lineStarts[t-1];return{line:t,col:e-i+1}}}};function Pe(n,e){for(let t=0;t<n.length;++t)if(n[t].type===e)return!0;return!1}function wr(n){for(let e=0;e<n.length;++e)switch(n[e].type){case"space":case"comment":case"newline":break;default:return e}return-1}function Sr(n){switch(n==null?void 0:n.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}function xs(n){var e;switch(n.type){case"document":return n.start;case"block-map":{let t=n.items[n.items.length-1];return(e=t.sep)!=null?e:t.start}case"block-seq":return n.items[n.items.length-1].start;default:return[]}}function et(n){var t;if(n.length===0)return[];let e=n.length;e:for(;--e>=0;)switch(n[e].type){case"doc-start":case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;((t=n[++e])==null?void 0:t.type)==="space";);return n.splice(e,n.length)}function vr(n){if(n.start.type==="flow-seq-start")for(let e of n.items)e.sep&&!e.value&&!Pe(e.start,"explicit-key-ind")&&!Pe(e.sep,"map-value-ind")&&(e.key&&(e.value=e.key),delete e.key,Sr(e.value)?e.value.end?Array.prototype.push.apply(e.value.end,e.sep):e.value.end=e.sep:Array.prototype.push.apply(e.start,e.sep),delete e.sep)}var It=class{constructor(e){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.lexer=new Ot,this.onNewLine=e}*parse(e,t=!1){this.onNewLine&&this.offset===0&&this.onNewLine(0);for(let s of this.lexer.lex(e,t))yield*this.next(s);t||(yield*this.end())}*next(e){if(this.source=e,this.atScalar){this.atScalar=!1,yield*this.step(),this.offset+=e.length;return}let t=yr(e);if(t)if(t==="scalar")this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,yield*this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&e[0]===" "&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":case"flow-error-end":return;default:this.atNewLine=!1}this.offset+=e.length}else{let s=`Not a YAML token: ${e}`;yield*this.pop({type:"error",offset:this.offset,message:s,source:e}),this.offset+=e.length}}*end(){for(;this.stack.length>0;)yield*this.pop()}get sourceToken(){return{type:this.type,offset:this.offset,indent:this.indent,source:this.source}}*step(){let e=this.peek(1);if(this.type==="doc-end"&&(!e||e.type!=="doc-end")){for(;this.stack.length>0;)yield*this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source});return}if(!e)return yield*this.stream();switch(e.type){case"document":return yield*this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return yield*this.scalar(e);case"block-scalar":return yield*this.blockScalar(e);case"block-map":return yield*this.blockMap(e);case"block-seq":return yield*this.blockSequence(e);case"flow-collection":return yield*this.flowCollection(e);case"doc-end":return yield*this.documentEnd(e)}yield*this.pop()}peek(e){return this.stack[this.stack.length-e]}*pop(e){let t=e!=null?e:this.stack.pop();if(!t)yield{type:"error",offset:this.offset,source:"",message:"Tried to pop an empty stack"};else if(this.stack.length===0)yield t;else{let s=this.peek(1);switch(t.type==="block-scalar"?t.indent="indent"in s?s.indent:0:t.type==="flow-collection"&&s.type==="document"&&(t.indent=0),t.type==="flow-collection"&&vr(t),s.type){case"document":s.value=t;break;case"block-scalar":s.props.push(t);break;case"block-map":{let i=s.items[s.items.length-1];if(i.value){s.items.push({start:[],key:t,sep:[]}),this.onKeyLine=!0;return}else if(i.sep)i.value=t;else{Object.assign(i,{key:t,sep:[]}),this.onKeyLine=!i.explicitKey;return}break}case"block-seq":{let i=s.items[s.items.length-1];i.value?s.items.push({start:[],value:t}):i.value=t;break}case"flow-collection":{let i=s.items[s.items.length-1];!i||i.value?s.items.push({start:[],key:t,sep:[]}):i.sep?i.value=t:Object.assign(i,{key:t,sep:[]});return}default:yield*this.pop(),yield*this.pop(t)}if((s.type==="document"||s.type==="block-map"||s.type==="block-seq")&&(t.type==="block-map"||t.type==="block-seq")){let i=t.items[t.items.length-1];i&&!i.sep&&!i.value&&i.start.length>0&&wr(i.start)===-1&&(t.indent===0||i.start.every(r=>r.type!=="comment"||r.indent<t.indent))&&(s.type==="document"?s.end=i.start:s.items.push({start:i.start}),t.items.splice(-1,1))}}}*stream(){switch(this.type){case"directive-line":yield{type:"directive",offset:this.offset,source:this.source};return;case"byte-order-mark":case"space":case"comment":case"newline":yield this.sourceToken;return;case"doc-mode":case"doc-start":{let e={type:"document",offset:this.offset,start:[]};this.type==="doc-start"&&e.start.push(this.sourceToken),this.stack.push(e);return}}yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source}}*document(e){if(e.value)return yield*this.lineEnd(e);switch(this.type){case"doc-start":{wr(e.start)!==-1?(yield*this.pop(),yield*this.step()):e.start.push(this.sourceToken);return}case"anchor":case"tag":case"space":case"comment":case"newline":e.start.push(this.sourceToken);return}let t=this.startBlockValue(e);t?this.stack.push(t):yield{type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source}}*scalar(e){if(this.type==="map-value-ind"){let t=xs(this.peek(2)),s=et(t),i;e.end?(i=e.end,i.push(this.sourceToken),delete e.end):i=[this.sourceToken];let r={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:s,key:e,sep:i}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=r}else yield*this.lineEnd(e)}*blockScalar(e){switch(this.type){case"space":case"comment":case"newline":e.props.push(this.sourceToken);return;case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}yield*this.pop();break;default:yield*this.pop(),yield*this.step()}}*blockMap(e){var s;let t=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,t.value){let i="end"in t.value?t.value.end:void 0,r=Array.isArray(i)?i[i.length-1]:void 0;(r==null?void 0:r.type)==="comment"?i==null||i.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else if(t.sep)t.sep.push(this.sourceToken);else{if(this.atIndentedComment(t.start,e.indent)){let i=e.items[e.items.length-2],r=(s=i==null?void 0:i.value)==null?void 0:s.end;if(Array.isArray(r)){Array.prototype.push.apply(r,t.start),r.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return}if(this.indent>=e.indent){let i=!this.onKeyLine&&this.indent===e.indent,r=i&&(t.sep||t.explicitKey)&&this.type!=="seq-item-ind",o=[];if(r&&t.sep&&!t.value){let a=[];for(let c=0;c<t.sep.length;++c){let l=t.sep[c];switch(l.type){case"newline":a.push(c);break;case"space":break;case"comment":l.indent>e.indent&&(a.length=0);break;default:a.length=0}}a.length>=2&&(o=t.sep.splice(a[1]))}switch(this.type){case"anchor":case"tag":r||t.value?(o.push(this.sourceToken),e.items.push({start:o}),this.onKeyLine=!0):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"explicit-key-ind":!t.sep&&!t.explicitKey?(t.start.push(this.sourceToken),t.explicitKey=!0):r||t.value?(o.push(this.sourceToken),e.items.push({start:o,explicitKey:!0})):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken],explicitKey:!0}]}),this.onKeyLine=!0;return;case"map-value-ind":if(t.explicitKey)if(t.sep)if(t.value)e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(Pe(t.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:o,key:null,sep:[this.sourceToken]}]});else if(Sr(t.key)&&!Pe(t.sep,"newline")){let a=et(t.start),c=t.key,l=t.sep;l.push(this.sourceToken),delete t.key,delete t.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:c,sep:l}]})}else o.length>0?t.sep=t.sep.concat(o,this.sourceToken):t.sep.push(this.sourceToken);else if(Pe(t.start,"newline"))Object.assign(t,{key:null,sep:[this.sourceToken]});else{let a=et(t.start);this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:a,key:null,sep:[this.sourceToken]}]})}else t.sep?t.value||r?e.items.push({start:o,key:null,sep:[this.sourceToken]}):Pe(t.sep,"map-value-ind")?this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]}):t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});this.onKeyLine=!0;return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{let a=this.flowScalar(this.type);r||t.value?(e.items.push({start:o,key:a,sep:[]}),this.onKeyLine=!0):t.sep?this.stack.push(a):(Object.assign(t,{key:a,sep:[]}),this.onKeyLine=!0);return}default:{let a=this.startBlockValue(e);if(a){if(a.type==="block-seq"){if(!t.explicitKey&&t.sep&&!Pe(t.sep,"newline")){yield*this.pop({type:"error",offset:this.offset,message:"Unexpected block-seq-ind on same line with key",source:this.source});return}}else i&&e.items.push({start:o});this.stack.push(a);return}}}}yield*this.pop(),yield*this.step()}*blockSequence(e){var s;let t=e.items[e.items.length-1];switch(this.type){case"newline":if(t.value){let i="end"in t.value?t.value.end:void 0,r=Array.isArray(i)?i[i.length-1]:void 0;(r==null?void 0:r.type)==="comment"?i==null||i.push(this.sourceToken):e.items.push({start:[this.sourceToken]})}else t.start.push(this.sourceToken);return;case"space":case"comment":if(t.value)e.items.push({start:[this.sourceToken]});else{if(this.atIndentedComment(t.start,e.indent)){let i=e.items[e.items.length-2],r=(s=i==null?void 0:i.value)==null?void 0:s.end;if(Array.isArray(r)){Array.prototype.push.apply(r,t.start),r.push(this.sourceToken),e.items.pop();return}}t.start.push(this.sourceToken)}return;case"anchor":case"tag":if(t.value||this.indent<=e.indent)break;t.start.push(this.sourceToken);return;case"seq-item-ind":if(this.indent!==e.indent)break;t.value||Pe(t.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return}if(this.indent>e.indent){let i=this.startBlockValue(e);if(i){this.stack.push(i);return}}yield*this.pop(),yield*this.step()}*flowCollection(e){let t=e.items[e.items.length-1];if(this.type==="flow-error-end"){let s;do yield*this.pop(),s=this.peek(1);while(s&&s.type==="flow-collection")}else if(e.end.length===0){switch(this.type){case"comma":case"explicit-key-ind":!t||t.sep?e.items.push({start:[this.sourceToken]}):t.start.push(this.sourceToken);return;case"map-value-ind":!t||t.value?e.items.push({start:[],key:null,sep:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):Object.assign(t,{key:null,sep:[this.sourceToken]});return;case"space":case"comment":case"newline":case"anchor":case"tag":!t||t.value?e.items.push({start:[this.sourceToken]}):t.sep?t.sep.push(this.sourceToken):t.start.push(this.sourceToken);return;case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{let i=this.flowScalar(this.type);!t||t.value?e.items.push({start:[],key:i,sep:[]}):t.sep?this.stack.push(i):Object.assign(t,{key:i,sep:[]});return}case"flow-map-end":case"flow-seq-end":e.end.push(this.sourceToken);return}let s=this.startBlockValue(e);s?this.stack.push(s):(yield*this.pop(),yield*this.step())}else{let s=this.peek(2);if(s.type==="block-map"&&(this.type==="map-value-ind"&&s.indent===e.indent||this.type==="newline"&&!s.items[s.items.length-1].sep))yield*this.pop(),yield*this.step();else if(this.type==="map-value-ind"&&s.type!=="flow-collection"){let i=xs(s),r=et(i);vr(e);let o=e.end.splice(1,e.end.length);o.push(this.sourceToken);let a={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:r,key:e,sep:o}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=a}else yield*this.lineEnd(e)}}flowScalar(e){if(this.onNewLine){let t=this.source.indexOf(`
`)+1;for(;t!==0;)this.onNewLine(this.offset+t),t=this.source.indexOf(`
`,t)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken],source:""};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":{this.onKeyLine=!0;let t=xs(e),s=et(t);return s.push(this.sourceToken),{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:s,explicitKey:!0}]}}case"map-value-ind":{this.onKeyLine=!0;let t=xs(e),s=et(t);return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:s,key:null,sep:[this.sourceToken]}]}}}return null}atIndentedComment(e,t){return this.type!=="comment"||this.indent<=t?!1:e.every(s=>s.type==="newline"||s.type==="space")}*documentEnd(e){this.type!=="doc-mode"&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop()))}*lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":yield*this.pop(),yield*this.step();break;case"newline":this.onKeyLine=!1;case"space":case"comment":default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],this.type==="newline"&&(yield*this.pop())}}};function Ho(n){let e=n.prettyErrors!==!1;return{lineCounter:n.lineCounter||e&&new Pt||null,prettyErrors:e}}function kr(n,e={}){let{lineCounter:t,prettyErrors:s}=Ho(e),i=new It(t==null?void 0:t.addNewLine),r=new xt(e),o=null;for(let a of r.compose(i.parse(n),!0,n.length))if(!o)o=a;else if(o.options.logLevel!=="silent"){o.errors.push(new ne(a.range.slice(0,2),"MULTIPLE_DOCS","Source contains multiple documents; please use YAML.parseAllDocuments()"));break}return s&&t&&(o.errors.forEach(bn(n,t)),o.warnings.forEach(bn(n,t))),o}function Pn(n,e,t){let s;typeof e=="function"?s=e:t===void 0&&e&&typeof e=="object"&&(t=e);let i=kr(n,t);if(!i)return null;if(i.warnings.forEach(r=>as(i.options.logLevel,r)),i.errors.length>0){if(i.options.logLevel!=="silent")throw i.errors[0];i.errors=[]}return i.toJS(Object.assign({reviver:s},t))}function Er(n){let e=Pn(n);return Jo(e.name)}function Jo(n){let e=document.createElement("div"),t=document.createElement("h1");return t.textContent=n,t.style.margin="0",t.style.padding="0",e.appendChild(t),e}var de=require("obsidian");var In=`<goal>
You are a creative research assistant specializing in knowledge expansion and mind mapping. Your primary function is to intelligently expand mind maps by generating relevant, well-researched child nodes that deepen understanding of any given topic. YOUR GOAL IS CREATE/UPDATE NOTE NODE ON MY MIND MAPS, YOU HAVE TO USE TOOLS
</goal>

<instructions>
1. **Analyze the parent node**: First, thoroughly understand the parent concept's context, scope, and current position in the mind map hierarchy.

2. **Research and validate**: Use available tools to gather current, accurate information about the topic before generating child nodes.

3. **Generate child nodes** that:
   - Build upon or drill deeper into the parent concept
   - Explore different aspects, applications, or perspectives  
   - Follow logical knowledge progression
   - Maintain relevance to the overall mind map theme
   - Avoid redundancy with existing nodes

4. **Prioritize diversity**: Ensure child nodes cover multiple dimensions (theoretical, practical, historical, future-oriented, etc.)

5. **Update the graph**: Use tools to properly connect new nodes and maintain structural integrity.
</instructions>

<quality>
Each child node should be:
- **Atomic**: Represents one clear, distinct concept
- **Specific**: Focused and well-defined, not overly broad
- **Actionable**: Can serve as a meaningful starting point for further exploration
- **Accurate**: Based on verified information and current understanding
- **Appropriately scoped**: Neither too granular nor too high-level for its position
- **Clearly labeled**: Uses precise, descriptive terminology
</quality>

<format>
For each generated child node, provide:
- Node title (concise, descriptive)
- Brief explanation of its relationship to the parent
- Key supporting details or context
- Suggested connections to other existing nodes (if applicable)
</format>`,tt=[{modelId:"gemini-2.5-pro",modelName:"Gemini 2.5 Pro",apiKey:"",color:"#4285F4"},{modelId:"gemini-2.5-flash",modelName:"Gemini 2.5 Flash",apiKey:"",color:"#DB4437"},{modelId:"gemini-2.5-flash-lite-preview-06-17	",modelName:"Gemini 2.5 Flash Lite",apiKey:"",color:"#DB4437"}],Ln={debug:!1,systemPrompt:In,socketAddress:"https://useai-server.fly.dev",models:tt,activeModelId:tt[0].modelId};var Bn=class extends de.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new de.Setting(e).setName("Gemini API Settings").setDesc("Configure your Gemini API key and select a model.").setHeading();let t=tt.reduce((r,o)=>(r[o.modelId]=o.modelName,r),{});new de.Setting(e).setName("Gemini Model").setDesc("Choose the Gemini model to use for AI features.").addDropdown(r=>{r.addOptions(t).setValue(this.plugin.settings.activeModelId).onChange(async o=>{this.plugin.settings.activeModelId=o,await this.plugin.saveSettings(),this.display()})});let s=this.plugin.settings.models.find(r=>r.modelId===this.plugin.settings.activeModelId),i=s;if(!s){let r=tt.find(o=>o.modelId===this.plugin.settings.activeModelId);r&&(i=r)}i?new de.Setting(e).setName(`API Key for ${i.modelName}`).setDesc(`Enter your Google AI Studio API key for the ${i.modelName} model.`).addText(r=>r.setPlaceholder("Enter API key for selected model").setValue(s?s.apiKey:"").onChange(async o=>{let a=this.plugin.settings.models.find(c=>c.modelId===this.plugin.settings.activeModelId);if(a)a.apiKey=o;else{let c=tt.find(l=>l.modelId===this.plugin.settings.activeModelId);c&&this.plugin.settings.models.push({...c,apiKey:o,modelId:c.modelId,modelName:c.modelName})}await this.plugin.saveSettings()})):new de.Setting(e).setName("API Key Configuration Error").setDesc("Could not find details for the active model. Please select a model from the list."),new de.Setting(e).setName("Socket Server Address").setDesc("The address of the UseAI WebSocket server (e.g., http://localhost:3000).").addText(r=>r.setPlaceholder("Enter WebSocket server address").setValue(this.plugin.settings.socketAddress).onChange(async o=>{this.plugin.settings.socketAddress=o,await this.plugin.saveSettings(),this.plugin.socket&&this.plugin.socket.connected&&this.plugin.socket.disconnect(),await this.plugin.initializeSocketConnection()})),new de.Setting(e).setName("Default system prompt").setDesc("The system prompt sent with each request to the API.").setClass("autoFlow").addTextArea(r=>{r.inputEl.rows=5,r.setValue(this.plugin.settings.systemPrompt),r.onChange(async o=>{this.plugin.settings.systemPrompt=o,await this.plugin.saveSettings()})}),new de.Setting(e).setName("Follow me on Twitter").setDesc("@duocdev").addButton(r=>{r.setCta(),r.setButtonText("Document").onClick(()=>{window.open("https://useai.aiocean.io/")})}).addButton(r=>{r.setCta(),r.setButtonText("Follow for update").onClick(()=>{window.open("https://twitter.com/duocdev")})}).addButton(r=>{r.setCta(),r.setButtonText("Bug report").onClick(()=>{window.open("https://aiocean.atlassian.net/servicedesk/customer/portal/5")})}).addButton(r=>{r.buttonEl.outerHTML="<a href='https://paypal.me/duocnguyen' target='_blank'><img style='border:0px;height:35px;' src='https://cdn.ko-fi.com/cdn/kofi3.png?v=3' /></a>"})}},Nr=Bn;var De=require("obsidian");var Lt="useai-prompt-view",Os=class extends De.ItemView{constructor(t,s){super(t);this.eventListeners=[];this.plugin=s}getViewType(){return Lt}getDisplayText(){return"AI Prompt"}getIcon(){return"sparkles"}async onOpen(){this.cleanupEventListeners();let t=this.containerEl.children[1];t.empty(),t.addClass("useai-prompt-view");let s=t.createEl("div",{cls:"useai-prompt-form"}),i=s.createEl("div",{cls:"useai-presets-section"});i.createEl("label",{text:"Quick Presets",cls:"useai-prompt-label"});let r=i.createEl("div",{cls:"useai-presets-grid"});[{name:"Summarize",prompt:`<task>
Please analyze the content of this canvas node and create a new child node with a comprehensive summary.
</task>

<instructions>
1. Read and understand the main content of the current node
2. Create a new child node connected to this parent node
3. Extract the key points, main ideas, and essential information
4. Write a clear, concise summary that captures the core message
5. Structure the summary with bullet points or short paragraphs for readability
6. Ensure the summary is 50-150 words unless the content requires more detail
</instructions>

<output_format>
Create a new canvas node titled "Summary: [Original Node Title]" with the summarized content organized clearly.
</output_format>`},{name:"Explain",prompt:`<task>
Please create a detailed explanation of the concepts in this node, making them accessible and easy to understand.
</task>

<instructions>
1. Analyze the content of the current canvas node
2. Identify complex concepts, technical terms, or abstract ideas
3. Create a new child node with clear explanations
4. Use simple language and analogies where appropriate
5. Break down complex ideas into digestible parts
6. Provide examples or real-world applications when relevant
7. Structure the explanation logically from basic to advanced concepts
</instructions>

<context>
Assume the reader may not be familiar with specialized terminology or advanced concepts. Your explanation should be educational and accessible.
</context>

<output_format>
Create a new canvas node titled "Explanation: [Topic]" with well-structured, easy-to-understand content.
</output_format>`},{name:"Expand",prompt:`<task>
Please expand on the ideas in this node with comprehensive details, examples, and deeper analysis.
</task>

<instructions>
1. Thoroughly analyze the existing content in the canvas node
2. Identify areas that can be developed further
3. Create a new child node with expanded content that includes:
   - Additional details and context
   - Relevant examples and case studies
   - Supporting evidence or research
   - Related concepts and connections
   - Practical applications or implications
4. Maintain logical flow and organization
5. Ensure all expansions directly relate to the original content
</instructions>

<thinking_guidance>
Think step by step about:
- What aspects need more detail?
- What examples would illustrate these points?
- What related concepts should be included?
- How can this information be made more actionable?
</thinking_guidance>

<output_format>
Create a new canvas node titled "Expanded: [Original Topic]" with comprehensive, well-organized expanded content.
</output_format>`},{name:"Questions",prompt:`<task>
Generate thoughtful, probing questions based on the content of this node to stimulate deeper thinking and exploration.
</task>

<instructions>
1. Carefully read and analyze the canvas node content
2. Create a new child node with diverse types of questions:
   - Analytical questions that probe deeper meaning
   - Critical thinking questions that challenge assumptions
   - Application questions about real-world use
   - Exploratory questions that open new avenues of thought
   - Clarification questions about unclear aspects
3. Generate 5-8 high-quality questions
4. Vary question types and complexity levels
5. Ensure questions are specific to the content, not generic
</instructions>

<question_types>
Include a mix of:
- "What if..." scenarios
- "How might..." application questions  
- "Why do you think..." analytical questions
- "What evidence supports..." critical questions
- "How does this relate to..." connection questions
</question_types>

<output_format>
Create a new canvas node titled "Key Questions: [Topic]" with numbered, well-crafted questions that encourage deep thinking.
</output_format>`},{name:"Key Points",prompt:`<task>
Extract and organize the most important points and main ideas from this node content into a clear, structured format.
</task>

<instructions>
1. Thoroughly read the canvas node content
2. Identify the core ideas, main arguments, and essential information
3. Create a new child node with key points organized as:
   - Primary themes or main ideas (3-5 points)
   - Supporting details for each main point
   - Important facts, data, or evidence
   - Key takeaways or conclusions
4. Use clear, concise language
5. Prioritize points by importance and relevance
6. Use bullet points, numbering, or clear headings for organization
</instructions>

<extraction_criteria>
Focus on information that is:
- Central to the main message
- Actionable or practically useful
- Memorable and significant
- Essential for understanding the topic
</extraction_criteria>

<output_format>
Create a new canvas node titled "Key Points: [Topic]" with well-organized, prioritized main ideas and supporting details.
</output_format>`},{name:"Pros & Cons",prompt:`<task>
Conduct a comprehensive analysis of the advantages and disadvantages of the ideas, concepts, or proposals presented in this node.
</task>

<instructions>
1. Carefully examine the content of the canvas node
2. Create a new child node with balanced analysis including:
   - Clear identification of what is being analyzed
   - Comprehensive list of advantages (pros)
   - Thorough list of disadvantages (cons)
   - Brief explanation for each pro and con
   - Overall assessment or conclusion
3. Consider multiple perspectives and stakeholders
4. Include both obvious and subtle advantages/disadvantages
5. Maintain objectivity and balance in the analysis
</instructions>

<analysis_framework>
Consider these dimensions:
- Short-term vs. long-term implications
- Different stakeholder perspectives
- Resource requirements and constraints
- Risk factors and mitigation strategies
- Practical implementation challenges
- Potential unintended consequences
</analysis_framework>

<output_format>
Create a new canvas node titled "Pros & Cons Analysis: [Topic]" with:
- Clear section headers for Pros and Cons
- Bullet points with brief explanations
- Balanced representation of both sides
- Summary conclusion if appropriate
</output_format>`}].forEach(p=>{let g=r.createEl("button",{cls:"useai-preset-btn",text:p.name,type:"button"}),u=()=>{this.promptInput.value=p.prompt,this.promptInput.focus()};g.addEventListener("click",u),this.eventListeners.push({element:g,event:"click",handler:u})});let a=s.createEl("div",{cls:"useai-prompt-section"});this.promptInput=a.createEl("textarea",{cls:"useai-prompt-input",placeholder:"Enter your prompt here or use presets above..."}),this.promptInput.rows=3,this.promptInput.focus();let c=s.createEl("div",{cls:"useai-logs-section"}),l=c.createEl("div",{cls:"useai-logs-header"});l.createEl("label",{text:"Logs",cls:"useai-prompt-label"});let f=l.createEl("button",{cls:"useai-clear-logs-btn",text:"Clear",type:"button"});this.logsContent=c.createEl("div",{cls:"useai-logs-content"});let h=()=>this.clearLogs();f.addEventListener("click",h),this.eventListeners.push({element:f,event:"click",handler:h});let d=p=>{p.key==="Enter"&&(p.preventDefault(),this.handleSubmit())};this.promptInput.addEventListener("keydown",d),this.eventListeners.push({element:this.promptInput,event:"keydown",handler:d}),this.registerEvent(this.plugin.events.on("log",p=>{this.addLogMessage(p)})),this.addStyles()}cleanupEventListeners(){for(let{element:t,event:s,handler:i}of this.eventListeners)t.removeEventListener(s,i);this.eventListeners=[]}addLogMessage(t){if(!this.logsContent)return;let s=document.createElement("div");s.classList.add("useai-log-entry");let i=document.createElement("span");i.classList.add("useai-log-timestamp"),i.textContent=new Date().toLocaleTimeString();let r=document.createElement("span");r.classList.add("useai-log-message"),r.textContent=t,s.appendChild(i),s.appendChild(r),this.logsContent.insertBefore(s,this.logsContent.firstChild);let o=100,a=this.logsContent.querySelectorAll(".useai-log-entry");if(a.length>o)for(let c=o;c<a.length;c++)a[c].remove();this.logsContent.scrollTop=0}clearLogs(){this.logsContent&&this.logsContent.empty()}async handleSubmit(){let t=this.promptInput.value.trim();if(!t){new De.Notice("Please enter a prompt"),this.promptInput.focus();return}if(!G(this.plugin.app)){new De.Notice("No active canvas found. Please open a canvas first.");return}try{await this.plugin.events.trigger("canvas:generate",t),new De.Notice("AI response generated successfully!"),this.promptInput.value=""}catch(i){console.error("Failed to generate AI response:",i),new De.Notice(`Failed to generate AI response: ${i instanceof Error?i.message:"Unknown error"}`)}}addStyles(){let t=document.createElement("style");t.textContent=`
            .useai-prompt-view {
                padding: 16px;
                height: 100%;
                display: flex;
                flex-direction: column;
            }

            .useai-prompt-header {
                margin-bottom: 20px;
                border-bottom: 1px solid var(--background-modifier-border);
                padding-bottom: 16px;
            }

            .useai-prompt-header h3 {
                margin: 0 0 8px 0;
                color: var(--text-normal);
            }

            .useai-prompt-description {
                margin: 0;
                color: var(--text-muted);
                font-size: 14px;
            }

            .useai-prompt-form {
                flex: 1;
                display: flex;
                flex-direction: column;
                gap: 16px;
            }

            .useai-presets-section {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            .useai-presets-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 8px;
                margin-bottom: 8px;
            }

            .useai-preset-btn {
                background: var(--interactive-normal);
                border: 1px solid var(--background-modifier-border);
                border-radius: 6px;
                padding: 8px 12px;
                font-size: 12px;
                color: var(--text-normal);
                cursor: pointer;
                transition: all 0.2s ease;
                text-align: center;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                min-height: 32px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .useai-preset-btn:hover {
                background: var(--interactive-hover);
                border-color: var(--interactive-accent);
                transform: translateY(-1px);
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .useai-preset-btn:active {
                transform: translateY(0);
                box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            }

            .useai-prompt-section {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            .useai-prompt-label {
                font-weight: 500;
                color: var(--text-normal);
                font-size: 14px;
                flex: 1;
            }

            .useai-prompt-input {
                width: 100%;
                min-height: 80px;
                padding: 12px;
                border: 1px solid var(--background-modifier-border);
                border-radius: 6px;
                background: var(--background-primary);
                color: var(--text-normal);
                font-family: var(--font-monospace);
                font-size: 14px;
                resize: vertical;
                transition: border-color 0.2s ease;
                box-sizing: border-box;
                flex: 1;
            }

            .useai-prompt-input:focus {
                outline: none;
                border-color: var(--interactive-accent);
                box-shadow: 0 0 0 2px var(--interactive-accent-hover);
            }

            .useai-logs-section {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            .useai-logs-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
            }

            .useai-clear-logs-btn {
                background: var(--interactive-normal);
                border: 1px solid var(--background-modifier-border);
                border-radius: 4px;
                padding: 4px 8px;
                font-size: 12px;
                color: var(--text-normal);
                cursor: pointer;
                transition: background-color 0.2s ease;
            }

            .useai-clear-logs-btn:hover {
                background: var(--interactive-hover);
            }

            .useai-logs-content {
                display: flex;
                flex-direction: column;
                gap: 4px;
                border-radius: 6px;
                overflow-y: auto;
            }

            .useai-log-entry {
                display: flex;
                gap: 8px;
                padding: 4px 0;
                border-bottom: 1px solid var(--background-modifier-border-hover);
                font-size: 12px;
                line-height: 1.4;
                max-height: 40px;
                overflow-y: hidden;
            }

            .useai-log-entry:last-child {
                border-bottom: none;
            }

            .useai-log-timestamp {
                color: var(--text-muted);
                font-family: var(--font-monospace);
                flex-shrink: 0;
                min-width: 70px;
            }

            .useai-log-message {
                color: var(--text-normal);
                word-break: break-word;
                flex: 1;
            }

            .useai-prompt-status {
                margin-top: 16px;
                padding: 12px;
                border-radius: 6px;
                background: var(--background-secondary);
                color: var(--text-muted);
                font-size: 12px;
                text-align: center;
            }
        `,document.head.appendChild(t)}async onClose(){this.cleanupEventListeners()}};var Ps=class extends B.Plugin{constructor(t,s,i){super(t,s);this.settings=Ln;this.statusSections={};this.events=new Ut}async onload(){await this.loadSettings(),await this.migrateSettings(),this.statusBar=this.addStatusBarItem(),this.initializeStatusBar(),await this.initializeSocketConnection(),await this.setupClientHandlers(),this.registerView(Lt,t=>new Os(t,this)),this.addRibbonIcon("sparkles","Open AI Prompt View",()=>{this.activatePromptView()}),this.addSettingTab(new Nr(this.app,this)),this.registerCommands(),this.patchObsidian(),this.registerEvents(),this.registerMarkdownCodeBlockProcessors()}async setupClientHandlers(){if(!this.socket){new B.Notice("No socket connection");return}Hn(this.socket,async({query:t})=>{this.app.internalPlugins.plugins["global-search"].instance.openGlobalSearch(t);let s=this.app.workspace.getLeavesOfType("search")[0],r=(await s.open(s.view)).dom.resultDomLookup;return Array.from(r.values()).map(a=>({title:a.file.name,path:a.file.path,content:a.content}))}),qn(this.socket,async t=>{new B.Notice(t)}),Vn(this.socket,async t=>{this.events.trigger("log",t)}),Fn(this.socket,async({text:t,nodeId:s})=>{let i=G(this.app);if(!i){new B.Notice("No active canvas");return}let r=i.nodes.get(s);if(!r){new B.Notice("Node not found");return}r.setText(t)}),Un(this.socket,async({size:t,text:s,parentIds:i,edge:r})=>{let o=G(this.app);if(!o)return new B.Notice("No active canvas"),"";t.width<500&&(t.width=500),t.height<300&&(t.height=300);let a=[];for(let l of i){let f=o.nodes.get(l);if(!f)return new B.Notice("Parent node not found"),"";a.push(f)}return"New node was created with id: "+(await zs(o,a,{size:t,text:s},void 0,r)).id}),jn(this.socket,async({section:t,status:s,message:i})=>{this.updateStatusBar(t,s,i)}),Kn(this.socket,async({data:t,nodeId:s})=>{let i=G(this.app);if(!i){new B.Notice("No active canvas");return}let r=i.nodes.get(s);if(!r){new B.Notice("Node not found");return}r.setData({...r.getData(),...t})}),Wn(this.socket,async({nodeId:t})=>{let s=G(this.app);if(!s){new B.Notice("No active canvas");return}let i=s.nodes.get(t);if(!i){new B.Notice("Node not found");return}s.removeNode(i)}),Yn(this.socket,async(t,s)=>{let i=G(this.app);if(!i){new B.Notice("No active canvas");return}let r=i.nodes.get(t);if(!r){new B.Notice("Node not found");return}if(r.nodeEl){let o=r.nodeEl.querySelector('[data-status-badge="true"]');o?o.textContent=s:(o=document.createElement("div"),o.textContent=s,o.style.height="20px",o.style.position="absolute",o.style.top="-10px",o.style.right="10px",o.style.zIndex="10",o.style.padding="0 5px",o.style.backgroundColor="rgba(0, 0, 0, 1)",o.style.borderRadius="5px",o.style.fontSize="12px",o.style.cursor="pointer",o.style.display="flex",o.style.alignItems="center",o.style.color="white",o.setAttribute("data-status-badge","true"),r.nodeEl.appendChild(o))}})}registerMarkdownCodeBlockProcessors(){this.registerMarkdownCodeBlockProcessor("useTool",(t,s,i)=>{let r=Er(t);s.appendChild(r)})}appendButtons(t,s,i){this.appendMenuButton(t,"lucide-sparkles","Generate with AI",()=>this.events.trigger("canvas:generate","generate childs notes to continues the idea of the parent node")),this.appendMenuButton(t,"lucide-plus","Create new empty node",()=>{zs(s,[i],{text:"",size:{width:350,height:350}},void 0)})}appendMenuButton(t,s,i,r){let o=createEl("button","clickable-icon gpt-menu-item");(0,B.setTooltip)(o,i,{placement:"top"}),(0,B.setIcon)(o,s),o.addEventListener("click",r),t.menuEl.appendChild(o)}isMenuPatched(t){return t.menuEl.querySelector(".gpt-menu-item")!==null}isNodeGenerating(t){return(t==null?void 0:t.status)==="generating"}registerEvents(){this.registerEvent(this.events.on("canvas:node-menu",(t,s,i)=>{let r=i.getData();this.isMenuPatched(t)||this.isNodeGenerating(r)||this.appendButtons(t,s,i)})),this.registerEvent(this.events.on("canvas:generate",async t=>{if(!this.socket){new B.Notice("No socket connection");return}let s=G(this.app);if(!s){new B.Notice("No active canvas found");return}await Li(this.socket,this.settings.systemPrompt,t,s,this.settings.activeModelId,this.settings.models)}))}patchObsidian(){this.app.workspace.onLayoutReady(()=>{if(Qs(this))return;let t=this.app.workspace.on("layout-change",()=>{Qs(this)&&this.app.workspace.offref(t)});this.registerEvent(t)})}async migrateSettings(){let t=!1;this.settings.systemPrompt===void 0&&(this.settings.systemPrompt=In,t=!0),this.settings.socketAddress===void 0&&(this.settings.socketAddress="https://useai-server.fly.dev",t=!0),t&&await this.saveSettings()}async loadSettings(){this.settings=Object.assign({},Ln,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}registerCommands(){this.addCommand(this.createContinueWritingCommand()),this.addCommand({id:"open-ai-prompt-view",name:"Open AI Prompt View",callback:()=>this.activatePromptView()}),this.addCommand({id:"show-plugin-status",name:"Show Plugin Status",callback:()=>this.showPluginStatus()}),this.addCommand({id:"canvas-generate-ai",name:"Generate AI content for selected canvas node",callback:()=>this.events.trigger("canvas:generate","")})}createContinueWritingCommand(){return{id:"continue-writing",name:"Continue writing",editorCallback:this.handleContinueWriting.bind(this)}}async handleContinueWriting(t,s){}initializeStatusBar(){this.updateStatusBar("connection","ready","Ready")}updateStatusBar(t,s,i){this.statusBar&&(this.statusSections[t]={status:s,message:i},this.renderStatusBar())}renderStatusBar(){if(!this.statusBar)return;this.statusBar.empty();let t=this.statusBar.createEl("div",{cls:"useai-status-container"});Object.entries(this.statusSections).forEach(([s,i],r)=>{r>0&&t.createEl("span",{cls:"useai-status-separator",text:" | "}),this.renderStatusSection(t,s,i)}),this.statusBar.addEventListener("click",()=>{let s=Object.entries(this.statusSections).map(([i,r])=>`${i}: ${r.message}`).join(`
`);new B.Notice(`UseAI Plugin Status:
${s}`)}),this.ensureStatusBarStyles()}renderStatusSection(t,s,i){let r=t.createEl("span",{cls:`useai-status-section useai-section-${s}`}),o=r.createEl("span",{cls:"useai-status-icon"});switch(i.status){case"ready":o.innerHTML="\u2713",o.style.color="#4CAF50";break;case"generating":o.innerHTML="\u27F3",o.style.color="#FF9800",o.style.animation="spin 1s linear infinite";break;case"error":o.innerHTML="\u2717",o.style.color="#F44336";break}let a=r.createEl("span",{cls:"useai-status-text",text:` ${this.getSectionDisplayName(s)}: ${i.message}`})}getSectionDisplayName(t){return{connection:"Conn"}[t]||t}ensureStatusBarStyles(){if(document.querySelector("#useai-status-styles"))return;let t=document.createElement("style");t.id="useai-status-styles",t.textContent=`            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            .useai-status-container {
                display: flex;
                align-items: center;
                font-size: 12px;
            }
            .useai-status-section {
                display: inline-flex;
                align-items: center;
            }
            .useai-status-icon {
                display: inline-block;
                font-weight: bold;
                font-size: 11px;
            }
            .useai-status-text {
                margin-left: 2px;
                font-size: 11px;
            }
            .useai-status-separator {
                color: var(--text-muted);
                margin: 0 4px;
                font-size: 10px;
            }
            .useai-section-connection .useai-status-text {
                color: var(--text-muted);
            }
        `,document.head.appendChild(t)}onunload(){let t=document.querySelector("#useai-status-styles");t&&t.remove(),xi()}async initializeSocketConnection(){try{if(!this.settings.socketAddress){new B.Notice("Socket address is not configured. Please set it in plugin settings."),this.updateStatusBar("connection","error","Not Configured");return}this.socket=ut(this.settings.socketAddress,{transports:["websocket","polling"],auth:{token:"123"},timeout:1e4}),this.socket.on("connect",()=>{console.log("\u2705 Connected to UseAI server"),this.updateStatusBar("connection","ready","Connected")}),this.socket.on("disconnect",t=>{console.log("\u{1F44B} Disconnected from UseAI server:",t),this.updateStatusBar("connection","error","Disconnected")}),this.socket.on("connect_error",t=>{this.updateStatusBar("connection","error","Connection failed")})}catch(t){this.updateStatusBar("connection","error","Connection failed")}}async activatePromptView(){let{workspace:t}=this.app,s=null,i=t.getLeavesOfType(Lt);i.length>0?s=i[0]:(s=t.getRightLeaf(!1),s&&await s.setViewState({type:Lt,active:!0})),s&&t.revealLeaf(s)}showPluginStatus(){let t=Object.entries(this.statusSections).map(([s,i])=>`${this.getSectionDisplayName(s)}: ${i.status} - ${i.message}`).join(`
`);new B.Notice(`UseAI Plugin Status:
${t}`)}};
/*! Bundled license information:

youtube-transcript/dist/youtube-transcript.esm.js:
  (*! *****************************************************************************
  Copyright (c) Microsoft Corporation.
  
  Permission to use, copy, modify, and/or distribute this software for any
  purpose with or without fee is hereby granted.
  
  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
  PERFORMANCE OF THIS SOFTWARE.
  ***************************************************************************** *)
*/
